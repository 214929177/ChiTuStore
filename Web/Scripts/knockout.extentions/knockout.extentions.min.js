(function(n){typeof define=="function"?define(["knockout"],n):n()})(function(){function f(element,name){var dlg=$(element).attr(name);return dlg?eval("(function(){return {"+dlg+"};})()"):{}}function e(n,t,i,r,u){var e=ko.unwrap(t());return e==null?t:$.proxy(function(){var n=this._element,i=this._valueAccessor,r=this._allBindings,u=this._viewModel,e=this._bindingContext,t=this._value;return function(i){var u=$.Deferred(),r,e;return u.resolve(),r=f(n,"data-dialog"),r.confirm&&(e=r.confirm,u=u.pipe(function(){var n=$.Deferred(),i=a,t=$(i).appendTo(document.body).modal()[0],r={text:e,ok:function(){$(t).modal("hide");n.resolve()},cancel:function(){n.reject()}};return ko.applyBindings(r,t),n})),u.pipe(function(){var u=$.isFunction(t)?t(i,event):t;return u&&$.isFunction(u.always)&&($(n).attr("disabled","disabled"),$(n).addClass("disabled"),u.element=n,u.always(function(){$(n).removeAttr("disabled");$(n).removeClass("disabled")}),setTimeout($.proxy(function(){$(this._element).removeAttr("disabled");$(this._element).removeClass("disabled")},{_element:n}),2e4),u.done(function(){if(r.toast){var t=r.toast,i=l,n=$(i).appendTo(document.body).modal()[0],u={text:t};window.setTimeout(function(){$(n).modal("hide");$(n).remove()},1e3);ko.applyBindings(u,n)}})),u})}},{_element:n,_valueAccessor:t,_allBindings:i,_viewModel:r,_bindingContext:u,_value:e})}function t(n){return n.substr(0,1)=="/"&&(n=site.config.imageBaseUrl+n),n}function s(n,t){var f=(t/n).toFixed(2),e="img_log"+f,u=localStorage.getItem(e),r;if(u)return u;var o=320,s=o*new Number(f),i=document.createElement("canvas");return i.width=o,i.height=s,r=i.getContext("2d"),r.fillStyle="whitesmoke",r.fillRect(0,0,i.width,i.height),r.font="Bold 40px Arial",r.textAlign="left",r.fillStyle="#999",r.fillText(site.config.storeName,i.width/2-75,i.height/2),u=i.toDataURL("image/png"),localStorage.setItem(e,u),u}var l='<div class="modal fade">     <div class="modal-dialog">         <div class="modal-content">             <div class="modal-body">                 <h5 data-bind="html:text"><\/h5>             <\/div>         <\/div>     <\/div> <\/div>',a='<div class="modal fade">     <div class="modal-dialog">         <div class="modal-content">             <div class="modal-body">                 <h5 data-bind="html:text"><\/h5>             <\/div>             <div class="modal-footer">                 <button data-bind="click:cancel" type="button" class="btn btn-default" data-dismiss="modal">取消<\/button>                 <button data-bind="click:ok" type="button" class="btn btn-primary">确认<\/button>             <\/div>         <\/div>     <\/div> <\/div>',n,i,r,u,o,v,h,c;return window.ko||(window.ko=arguments[0]),Number.prototype.toFormattedString=function(n){var i=new RegExp("^C[0-9]+"),t;return i.test(n)?(t=n.substr(1),this.toFixed(t)):this},Date.prototype.toFormattedString=function(n){switch(n){case"d":return chitu.Utility.format("{0}-{1}-{2}",this.getFullYear(),this.getMonth()+1,this.getDate());case"g":return chitu.Utility.format("{0}-{1}-{2} {3}:{4}",this.getFullYear(),this.getMonth()+1,this.getDate(),this.getHours(),this.getMinutes());case"G":return chitu.Utility.format("{0}-{1}-{2} {3}:{4}:{5}",this.getFullYear(),this.getMonth()+1,this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds());case"t":return chitu.Utility.format("{0}:{1}",this.getHours(),this.getMinutes());case"T":return chitu.Utility.format("{0}:{1}:{2}",this.getHours(),this.getMinutes(),this.getSeconds())}return n!=null&&$.datepicker!=null?$.datepicker.formatDate(n,this):this.toString()},n=function(n,t){for(var e,f,o,u,c,r,i=1;i<t.length;i++)t[i]=ko.unwrap(t[i]);for(e="",f=t[0],i=0;;){if(o=f.indexOf("{",i),u=f.indexOf("}",i),o<0&&u<0){e+=f.slice(i);break}if(u>0&&(u<o||o<0)){if(f.charAt(u+1)!=="}")throw Error.argument("format","Sys.Res.stringFormatBraceMismatch");e+=f.slice(i,u+1);i=u+2;continue}if(e+=f.slice(i,o),i=o+1,f.charAt(i)==="{"){e+="{";i++;continue}if(u<0)throw Error.argument("format","Sys.Res.stringFormatBraceMismatch");var s=f.substring(i,u),h=s.indexOf(":"),l=parseInt(h<0?s:s.substring(0,h),10)+1;if(isNaN(l))throw Error.argument("format","Sys.Res.stringFormatInvalid");c=h<0?"":s.substring(h+1);r=t[l];(typeof r=="undefined"||r===null)&&(r="");e+=r.toFormattedString?r.toFormattedString(c):n&&r.localeFormat?r.localeFormat(c):r.format?r.format(c):r.toString();i=u+1}return e},i=function(t,i){var u,r=i();u=r<0?n(!0,["-￥{0:C2}",Math.abs(r)]):n(!0,["￥{0:C2}",r]);t.innerHTML=u},ko.bindingHandlers.money={init:function(n,t){i(n,t)},update:function(n,t){i(n,t)}},r=function(t,i){var r=i(),u;$.isArray(r)?(u=n(!0,r),$(t).attr("href",u)):$(t).attr("href",r)},ko.bindingHandlers.href={init:function(n,t){r(n,t)},update:function(n,t){r(n,t)}},u=function(t,i){var r=i(),u=$.isArray(r)?n(!0,r):r;ko.utils.setTextContent(t,u)},ko.bindingHandlers.text={init:function(n,t){return u(n,t)},update:function(n,t){return u(n,t)}},o=ko.bindingHandlers.click,ko.bindingHandlers.click={init:function(n,t,i,r,u){return t=e(n,t,i,r,u),o.init(n,t,i,r,u)}},v=function(){var u=200,n=0,i=[],r=$.Callbacks();return window.setInterval(function(){if(!(i.length<=0)&&!(n>=u)){var e=i.shift(),f=e.element,o=e.src;f.image=new Image;f.image.element=f;f.image.src=t(o);n=n+1;f.image.onload=function(){this.element.src=this.src;n=n-1;r.fire(this.element)};f.image.onerror=function(){n=n-1}}},100),{load:function(n,t){i.push({element:n,src:t})},imageLoaded:r}}(),h=ko.bindingHandlers.attr,ko.bindingHandlers.attr=function(){return{update:function(n,i,r){if(n.tagName=="IMG"){var e=f(n,"data-image"),u=ko.utils.unwrapObservable(i())||{};ko.utils.objectForEach(u,function(r,f){var h=ko.unwrap(f),o,v;if(r!="src"||!h)return!0;if(o=h.match(/_\d+_\d+/),o&&o.length>0){var c=o[0].split("_"),l=new Number(c[1]).valueOf(),a=new Number(c[2]).valueOf();$(n).attr("width",l+"px");$(n).attr("height",a+"px");(e.showLogo==null||e.showLogo==!0)&&(v=s(l,a));i=$.proxy(function(){var n=ko.utils.unwrapObservable(this._source()),u=ko.unwrap(n.src),r,i;return n.src=this._src,r=this._element,i=new Image,i.onload=function(){r.src=this.src},i.src=t(u),n},{_source:i,_src:v,_element:n})}else u.src=h,i=$.proxy(function(){return this._value},{_value:u})})}return h.update(n,i,r)}}}(),c=ko.bindingHandlers.html,ko.bindingHandlers.html={update:function(n,i,r){var u=c.update(n,i,r),f=$(n).find("img");return f.each(function(){var r=$(this).attr("src"),n,o,i;if($(this).addClass("img-full"),n=r.match(/_\d+_\d+/),n&&n.length>0){var u=n[0].split("_"),f=new Number(u[1]).valueOf(),e=new Number(u[2]).valueOf();$(this).attr("width",f+"px");$(this).attr("height",e+"px");o=s(f,e);$(this).attr("src",o);i=new Image;i.element=this;i.onload=function(){$(this.element).attr("src",this.src)};i.src=t(r)}else $(this).attr("src",t(r))}),u}},ko.bindingHandlers.tap={init:function(n,t,i,r,u){t=e(n,t,i,r,u);$(n).on("tap",$.proxy(function(n){this._valueAccessor()(r,n)},{_valueAccessor:t}))}},ko});
//# sourceMappingURL=knockout.extentions.min.js.map
