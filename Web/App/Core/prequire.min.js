var _amd=define.amd;define.amd=undefined,function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof module!="undefined"&&module.exports?module.exports=n(require(["jquery"])):window.chitu=n()}(function(){
/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
var t=function(){function t(n,t){if(n.indexOf)return n.indexOf(t);for(var i=n.length;i--;)if(n[i]===t)return i;return-1}function e(n,i){var r=t(n,i);r!==-1&&n.splice(r,1)}function o(n,t){return"[object "+t+"]"===Object.prototype.toString.call(n)}function s(n){return o(n,"RegExp")}function l(n){return o(n,"Array")}function h(n){return typeof n=="function"}function r(n){return n===null||n==="null"?null:n==="true"?!0:n==="false"?!1:n===f||n==="undefined"?f:n===""||isNaN(n)?n:parseFloat(n)}function a(n){for(var t=n.length,i=[];t--;)i[t]=r(n[t]);return i}function v(n,t){for(var f=(n||"").replace("?","").split("&"),e=f.length,o={},i,u;e--;)i=f[e].split("="),u=t?r(i[1]):i[1],o[i[0]]=typeof u=="string"?decodeURIComponent(u):u;return o}function i(){this.bypassed=$.Callbacks();this.routed=$.Callbacks();this._routes=[];this._prevRoutes=[];this._piped=[];this.resetState()}function c(n,t,i,r){var u=s(n),f=r.patternLexer;this._router=r;this._pattern=n;this._paramsIds=u?null:f.getParamIds(n);this._optionalParamsIds=u?null:f.getOptionalParamsIds(n);this._matchRegexp=u?n:f.compilePattern(n,r.ignoreCase);this.matched=$.Callbacks();this.switched=$.Callbacks();t&&this.matched.add(t);this._priority=i||0}var n,u,f;return u=/t(.+)?/.exec("t")[1]==="",i.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0;this._prevMatchedRequest=null;this._prevBypassedRequest=null},create:function(){return new i},addRoute:function(n,t,i){var r=new c(n,t,i,this);return this._sortedInsert(r),r},removeRoute:function(n){e(this._routes,n);n._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(n,t){if(n=n||"",t=t||[],this.ignoreState||n!==this._prevMatchedRequest&&n!==this._prevBypassedRequest){var r=this._getMatchedRoutes(n),u=0,f=r.length,i;if(f)for(this._prevMatchedRequest=n,this._notifyPrevRoutes(r,n),this._prevRoutes=r;u<f;)i=r[u],i.route.matched.fire.apply(i.route.matched,t.concat(i.params)),i.isFirst=!u,this.routed.fire.apply(this.routed,t.concat([n,i])),u+=1;else this._prevBypassedRequest=n,this.bypassed.fire.apply(this.bypassed,t.concat([n]));this._pipeParse(n,t)}},_notifyPrevRoutes:function(n,t){for(var r=0,i;i=this._prevRoutes[r++];)i.route.switched&&this._didSwitch(i.route,n)&&i.route.switched.fire(t)},_didSwitch:function(n,t){for(var i,r=0;i=t[r++];)if(i.route===n)return!1;return!0},_pipeParse:function(n,t){for(var r=0,i;i=this._piped[r++];)i.parse(n,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(n){var t=this._routes,i=t.length;do--i;while(t[i]&&n._priority<=t[i]._priority);t.splice(i+1,0,n)},_getMatchedRoutes:function(n){for(var i=[],r=this._routes,u=r.length,t;t=r[--u];)if((!i.length||this.greedy||t.greedy)&&t.match(n)&&i.push({route:t,params:t._getParamsArray(n)}),!this.greedyEnabled&&i.length)break;return i},pipe:function(n){this._piped.push(n)},unpipe:function(n){e(this._piped,n)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},n=new i,n.VERSION="0.12.0",n.NORM_AS_ARRAY=function(n,t){return[t.vals_]},n.NORM_AS_OBJECT=function(n,t){return[t]},c.prototype={greedy:!1,rules:void 0,match:function(n){return n=n||"",this._matchRegexp.test(n)&&this._validateParams(n)},_validateParams:function(n){var i=this.rules,r=this._getParamsObject(n);for(var t in i)if(t!=="normalize_"&&i.hasOwnProperty(t)&&!this._isValidParam(n,t,r))return!1;return!0},_isValidParam:function(n,i,r){var u=this.rules[i],f=r[i],e=!1,o=i.indexOf("?")===0;return f==null&&this._optionalParamsIds&&t(this._optionalParamsIds,i)!==-1?e=!0:s(u)?(o&&(f=r[i+"_"]),e=u.test(f)):l(u)?(o&&(f=r[i+"_"]),e=this._isValidArrayRule(u,f)):h(u)&&(e=u(f,n,r)),e},_isValidArrayRule:function(n,i){if(!this._router.ignoreCase)return t(n,i)!==-1;typeof i=="string"&&(i=i.toLowerCase());for(var u=n.length,r,f;u--;)if(r=n[u],f=typeof r=="string"?r.toLowerCase():r,f===i)return!0;return!1},_getParamsObject:function(n){for(var h=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(n,this._matchRegexp,h),f={},e=o.length,s,i;e--;)i=o[e],this._paramsIds&&(s=this._paramsIds[e],s.indexOf("?")===0&&i&&(f[s+"_"]=i,i=v(i,h),o[e]=i),u&&i===""&&t(this._optionalParamsIds,s)!==-1&&(i=void 0,o[e]=i),f[s]=i),f[e]=i;return f.request_=h?r(n):n,f.vals_=o,f},_getParamsArray:function(n){var t=this.rules?this.rules.normalize_:null;return t=t||this._router.normalizeFn,t&&h(t)?t(n,this._getParamsObject(n)):this._getParamsObject(n).vals_},interpolate:function(n){var t=this._router.patternLexer.interpolate(this._pattern,n);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.empty();this.switched.empty();this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},i.prototype.patternLexer=function(){function l(){var i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],t.id="__CR_"+i+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function e(n,t){var i=[],r;for(n.lastIndex=0;r=n.exec(t);)i.push(r[1]);return i}function v(n){return e(r,n)}function y(t){return e(n.OP.rgx,t)}function p(n,r){return n=n||"",n&&(t===i?n=n.replace(h,""):t===f&&(n=n.replace(c,"")),n=o(n,"rgx","save"),n=n.replace(s,"\\$&"),n=o(n,"rRestore","res"),t===i&&(n="\\/?"+n)),t!==u&&(n+="\\/?"),new RegExp("^"+n+"$",r?"i":"")}function o(t,i,r){var u;for(var f in n)n.hasOwnProperty(f)&&(u=n[f],t=t.replace(u[i],u[r]));return t}function w(n,t,i){var r=t.exec(n);return r&&(r.shift(),i&&(r=a(r))),r}function b(t,i){if(typeof t!="string")throw new Error("Route pattern should be a string.");var u=function(n,t){var r,u,f;if(t=t.substr(0,1)==="?"?t.substr(1):t,i[t]!=null){if(typeof i[t]=="object"){u=[];for(f in i[t])u.push(encodeURI(f+"="+i[t][f]));r="?"+u.join("&")}else r=String(i[t]);if(n.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+n+'".');}else if(n.indexOf("{")!==-1)throw new Error("The segment "+n+" is required.");else r="";return r};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),t.replace(n.OS.rgx,n.OS.save).replace(r,u).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var s=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,c=/\/$/g,r=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},i=1,u=2,f=3,t=i;return l(),{strict:function(){t=u},loose:function(){t=i},legacy:function(){t=f},getParamIds:v,getOptionalParamsIds:y,getParamValues:w,compilePattern:p,interpolate:b}}(),window.crossroads=n,n},n;return window.crossroads=t(window.jQuery),function(n){var t=n.Errors,i=function(){function n(){}return n.isType=function(n,t){for(var i in n.prototype)if(t[i]===undefined)return!1;return!0},n.isDeferred=function(n){return n==null?!1:n.pipe!=null&&n.always!=null&&n.done!=null?!0:!1},n.format=function(n,t,i,r,u,f,e,o,s,h,c){for(var a=[t,i,r,u,f,e,o,s,h,c],l=0;l<a.length;l++){if(a[l]==null)break;n=n.replace(new RegExp("\\{"+l+"\\}","g"),function(){return a[l]})}return n},n.fileName=function(n,i){var r,u;if(!n)throw t.argumentNull("url");return i=i||!0,n=n.replace("http://","/"),r=n.replace(/^.*[\\\/]/,""),i===!0&&(u=r.split("."),r=u[0]),r},n.log=function(n,t){if(t===void 0&&(t=[]),window.console){if(t==null){console.log(n);return}var i=this.format.apply(this,arguments);console.log(i)}},n}();n.Utility=i}(n||(n={})),function(n){var t=n.Utility,i=function(){function n(){}return n.argumentNull=function(n){var i=t.format('The argument "{0}" cannt be null.',n);return new Error(i)},n.modelFileExpecteFunction=function(n){var i=t.format('The eval result of script file "{0}" is expected a function.',n);return new Error(i)},n.paramTypeError=function(n,i){var r=t.format('The param "{0}" is expected "{1}" type.',n,i);return new Error(r)},n.viewNodeNotExists=function(n){var i=t.format('The view node "{0}" is not exists.',n);return new Error(i)},n.pathPairRequireView=function(n){var i=t.format('The view value is required for path pair, but the item with index "{0}" is miss it.',n);return new Error(i)},n.notImplemented=function(n){var i=t.format('The method "{0}" is not implemented.',n);return new Error(i)},n.routeExists=function(n){var i=t.format('Route named "{0}" is exists.',n);return new Error(i)},n.routeResultRequireController=function(n){var i=t.format('The parse result of route "{0}" does not contains controler.',n);return new Error(i)},n.routeResultRequireAction=function(n){var i=t.format('The parse result of route "{0}" does not contains action.',n);return new Error(i)},n.ambiguityRouteMatched=function(n,i,r){var u=t.format("Ambiguity route matched, {0} is match in {1} and {2}.",n,i,r);return new Error(u)},n.noneRouteMatched=function(n){var i=t.format('None route matched with url "{0}".',n);return new Error(i)},n.emptyStack=function(){return new Error("The stack is empty.")},n.canntParseUrl=function(n){var i=t.format('Can not parse the url "{0}" to route data.',n);return new Error(i)},n.routeDataRequireController=function(){return new Error('The route data does not contains a "controller" file.')},n.routeDataRequireAction=function(){return new Error('The route data does not contains a "action" file.')},n.parameterRequireField=function(n,i){var r=t.format("Parameter {1} does not contains field {0}.",n,i);return new Error(r)},n}();n.Errors=i}(n||(n={})),function(n){function u(n){var t=i[n]={};return jQuery.each(n.match(r)||[],function(n,i){t[i]=!0}),t}function e(t){t===void 0&&(t=null);t=typeof t=="string"?i[t]||u(t):jQuery.extend({},t);var e,l,h,a,o,s,r=[],f=!t.once&&[],v=function(n){for(e=t.memory&&n,l=!0,s=a||0,a=0,o=r.length,h=!0;r&&s<o;s++){var i=r[s].apply(n[0],n[1]);if(i!=null&&n[0].results.push(i),i===!1&&t.stopOnFalse){e=!1;break}}h=!1;r&&(f?f.length&&v(f.shift()):e?r=[]:c.disable())},c={results:[],add:function(){if(r){var n=r.length;(function i(n){jQuery.each(n,function(n,u){var f=jQuery.type(u);f==="function"?t.unique&&c.has(u)||r.push(u):u&&u.length&&f!=="string"&&i(u)})})(arguments);h?o=r.length:e&&(a=n,v(e))}return this},remove:function(){return r&&jQuery.each(arguments,function(n,t){for(var i;(i=jQuery.inArray(t,r,i))>-1;)r.splice(i,1),h&&(i<=o&&o--,i<=s&&s--)}),this},has:function(n){return n?jQuery.inArray(n,r)>-1:!!(r&&r.length)},empty:function(){return r=[],o=0,this},disable:function(){return r=f=e=undefined,this},disabled:function(){return!r},lock:function(){return f=undefined,e||c.disable(),this},locked:function(){return!f},fireWith:function(n,t){return n.results=[],r&&(!l||f)&&(t=t||[],t=[n,t.slice?t.slice():t],h?f.push(t):v(t)),n.results},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!l},count:function(){return r.length}};return new n.Callback(c)}function o(t,i){for(var u=t.fire.apply(t,i),f=[],r=0;r<u.length;r++)n.Utility.isDeferred(u[r])&&f.push(u[r]);return f.length==0?$.Deferred().resolve():$.when.apply($,f)}var r=/\S+/g,i={},f=function(){function n(n){this.source=n}return n.prototype.add=function(n){this.source.add(n)},n.prototype.remove=function(n){this.source.remove(n)},n.prototype.has=function(n){return this.source.has(n)},n.prototype.fireWith=function(n,t){return this.source.fireWith(n,t)},n.prototype.fire=function(n,t,i){return this.source.fire(n,t,i)},n}(),t;n.Callback=f;n.Callbacks=e;n.fireCallback=o;t=window.crossroads;$.extend(t,{_create:t.create,create:function(){var t=this._create();return t.getRouteData=function(t,i){if(t=t||"",i=i||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var r=this._getMatchedRoutes(t),u=r.length;if(u==0)return null;if(u>1)throw n.Errors.ambiguityRouteMatched(t,"route1","route2");return r[0]}},t}})}(n||(n={})),function(n){var t=n,i=n.Errors,r=function(){function r(n,i){this.pageCreating=t.Callbacks();this.pageCreated=t.Callbacks();this.pageShowing=t.Callbacks();this.pageShown=t.Callbacks();this.init(n,i)}return r.prototype.init=function(n,t){this._app=n;this._node=t;this._pageStack=[]},r.prototype.on_pageCreating=function(n){return t.fireCallback(this.pageCreating,[this,n])},r.prototype.on_pageCreated=function(n){return t.fireCallback(this.pageCreated,[this,n])},r.prototype.on_pageShowing=function(n,i){return t.fireCallback(this.pageShowing,[this,n,i])},r.prototype.on_pageShown=function(n,i){return t.fireCallback(this.pageShown,[this,n,i])},r.prototype.application=function(){return this._app},r.prototype.node=function(){return this._node},r.prototype.currentPage=function(){return this._currentPage},r.prototype._createPage=function(n,r){var u,f;if(!n)throw i.argumentNull("url");if(typeof n!="string")throw i.paramTypeError("url","String");if(r||(r=document.createElement("div"),document.body.appendChild(r)),u=this.application().routes().getRouteData(n),u==null)throw i.noneRouteMatched(n);var h=u.values().controller,c=u.values().action,o=this.application().controller(u),s=this.application().viewFactory.view(u),e=new t.ControllerContext(o,s,u);this.on_pageCreating(e);f=new t.Page(e,r);this.on_pageCreated(f);return f},r.prototype.showPage=function(t,r){var e,u,a,c,o,s;if(r=r||{},!t)throw i.argumentNull("url");if(e=this.application().routes().getRouteData(t),e==null)throw i.noneRouteMatched(t);var h=this.node(),v=e.values().controller,y=e.values().action,l=n.Page.getPageName(e),f=$(h).data("pages");f||(f={},$(h).data("pages",f));o=this;u=f[l];u==null&&(a=$("<div>").appendTo(h)[0],u=this._createPage(t,a),f[l]=u);this._currentPage=u;for(c in f)f[c]!=this._currentPage&&f[c].visible(!1);return $.extend(r,e.values()),o=this,s=$.Deferred(),this.on_pageShowing(u,r).pipe(function(){return u.open(r)}).done($.proxy(function(){o._pageStack.push({page:this.page,url:this.url});this.page!=o.currentPage()&&this.page.visible(!1);this.result.resolve(this.page);o.on_pageShown(this.page,r)},{page:u,result:s,url:t})).fail($.proxy(function(n){this.result.reject(this.page,n)},{page:u,result:s,url:t})),s},r.prototype.back=function(n){var i=this._pageStack,r=this.currentPage(),t,u;return i.length==0||r==null?$.Deferred().reject():(i.pop(),t=i[i.length-1],t==null)?$.Deferred().reject():(u="#"+t.url.toLowerCase(),u.localeCompare(window.location.hash.toLowerCase())!=0&&(window.location.hash=t.url,window.location.skip=!0),r.visible(!1),n?t.page.open(n):t.page.visible(!0),this._currentPage=t.page,$.Deferred().resolve())},r}();n.PageContainer=r}(n||(n={})),function(n){function i(t,i,r){return r===void 0&&(r={}),n.fireCallback(t,[i,r])}var t=n,u=n.Utility,r=n.Errors,f=function(){function n(i,u){if(this._node=HTMLElement,this._visible=!0,this._loadViewModelResult=null,this._showResult=null,this._hideResult=null,this.created=t.Callbacks(),this.creating=t.Callbacks(),this.preLoad=t.Callbacks(),this.load=t.Callbacks(),this.closing=t.Callbacks(),this.closed=t.Callbacks(),this.scroll=t.Callbacks(),this.showing=t.Callbacks(),this.shown=t.Callbacks(),this.hiding=t.Callbacks(),this.hidden=t.Callbacks(),this._type="Page",!i)throw r.argumentNull("context");if(!u)throw r.argumentNull("node");this._context=i;var s=i.routeData().values().controller,h=i.routeData().values().action,f=n.getPageName(i.routeData()),e=i.view(),o=i.controller().action(i.routeData());this.init(f,e,o,u)}return n.getPageName=function(n){var t,i;return n.pageName()?(i=window.crossroads.addRoute(n.pageName()),t=i.interpolate(n.values())):t=n.values().controller+"."+n.values().action,t},n.prototype.context=function(){return this._context},n.prototype.name=function(){return this._name},n.prototype.node=function(){return this._node},n.prototype.parent=function(){return this._parent},n.prototype.visible=function(n){var t=$(this.node()).is(":visible");if(n===undefined)return t;if(n!=t){if(n){this.on_showing({});$(this.node()).show();this.on_shown({})}else{this.on_hiding({});$(this.node()).hide();this.on_hidden({})}this._visible=n}},n.prototype.init=function(n,t,i,u){if(!n)throw r.argumentNull("name");if(!t)throw r.argumentNull("viewDeferred");if(!i)throw r.argumentNull("actionDeferred");if(!u)throw r.argumentNull("node");this._name=n;this._viewDeferred=t;this._actionDeferred=i;this._parent;this._node=u;this._visible=!0;$(this._node).hide()},n.prototype.on_creating=function(n){return i(this.creating,this,n)},n.prototype.on_created=function(){return i(this.created,this)},n.prototype.on_preLoad=function(n){return i(this.preLoad,this,n)},n.prototype.on_load=function(n){return i(this.load,this,n)},n.prototype.on_closing=function(n){return i(this.closing,this,n)},n.prototype.on_closed=function(n){return i(this.closed,this,n)},n.prototype.on_scroll=function(n){return i(this.scroll,this,n)},n.prototype.on_showing=function(n){return i(this.showing,this,n)},n.prototype.on_shown=function(n){return i(this.shown,this,n)},n.prototype.on_hiding=function(n){return i(this.hiding,this,n)},n.prototype.on_hidden=function(n){return i(this.hidden,this,n)},n.prototype._appendNode=function(n){if(n==null)throw r.argumentNull("childNode");$(this._node).append(n)},n.prototype._loadViewModel=function(){if(this._loadViewModelResult)return this._loadViewModelResult;var n=this;return this._loadViewModelResult=this._viewDeferred.pipe(function(t){return u.log("Load view success, page:{0}.",[n._name]),$(n.node()).append(t),n._actionDeferred}).pipe(function(t){var i=t.execute(n);return(n.on_created(),u.isDeferred(i))?i:$.Deferred().resolve()}).fail(function(){n._loadViewModelResult=null;u.log("Load view or action fail, page：{0}.",[n._name])}),this._loadViewModelResult},n.prototype.open=function(n){var t=this;return this._showResult=this.on_preLoad(n).pipe(function(){return t._loadViewModel()}).pipe(function(){t.on_showing(n);return t.on_load(n)}),this._showResult.done($.proxy(function(){t._hideResult=null;$(t.node()).show();t.on_shown(this.args)},{args:n})),this._showResult},n.prototype.close=function(n){var t=this;return this._hideResult||(this._hideResult=t.on_closing(n).pipe(function(){t.visible(!1);return t.on_closed(n)})),this._hideResult.always(function(){t._hideResult=null})},n}();n.Page=f}(n||(n={})),function(n){function e(n,t){var u="http://".toLowerCase(),i,r;return n.substr(0,u.length).toLowerCase()==u?(i=document.createElement("a"),i.setAttribute("href",n),n=decodeURI(i.pathname),r=f.addRoute(n),u+i.host+r.interpolate(t)):(r=f.addRoute(n),r.interpolate(t))}function s(n,i,r){var u;switch(arguments.length){case 0:throw t.argumentNull("func");case 1:if(typeof arguments[0]!="function")throw t.paramTypeError("arguments[0]","Function");r=n;i=n=[];break;case 2:if(r=i,typeof r!="function")throw t.paramTypeError("func","Function");if(!$.isArray(n))throw t.paramTypeError("deps","Array");n.length==0?n=i=[]:typeof n[0]=="function"?(i=n,n=[]):i=[]}for(u=0;u<n.length;u++)if(typeof n[u]!="string")throw t.paramTypeError("deps["+u+"]","string");for(u=0;u<i.length;u++)if(typeof i[u]!="function")throw t.paramTypeError("filters["+u+"]","function");if(!$.isFunction(r))throw t.paramTypeError("func","function");return define(n,$.proxy(function(){var n=Array.prototype.slice.call(arguments,0),t=this.func,i=this.filters;return{func:function(i){return n.unshift(i),t.apply(t,n)},filters:i}},{func:r,filters:i})),r}var i=n,t=i.Errors,r=i.Utility,f=window.crossroads,o=function(){function f(t){this._actions={};this._name=t;this._actions={};this.actionCreated=n.Callbacks()}return f.prototype.name=function(){return this._name},f.prototype.action=function(n){var r=n.values().controller,i,u;if(!r)throw t.routeDataRequireController();if(this._name!=r)throw new Error("Not same a controller.");if(i=n.values().action,!i)throw t.routeDataRequireAction();return u=this,this._actions[i]||(this._actions[i]=this._createAction(n).fail($.proxy(function(){u._actions[this.actionName]=null},{actionName:n}))),this._actions[i]},f.prototype._createAction=function(n){var o=n.values().action;if(!o)throw t.routeDataRequireAction();var f=this,h=e(n.actionPath(),n.values()),s=$.Deferred();return require([h],$.proxy(function(n){var t,e;if(n||(console.warn(r.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",this.actionName,f.name())),n={func:function(){}}),t=n.func||n,!$.isFunction(t))throw i.Errors.modelFileExpecteFunction(this.actionName);e=new u(f,this.actionName,t);f.actionCreated.fire(f,e);this.result.resolve(e)},{actionName:o,result:s}),$.proxy(function(){console.warn(r.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",this.actionName,f.name()));var n=new u(f,this.actionName,function(){});f.actionCreated.fire(f,n);this.result.resolve(n)},{actionName:o,result:s})),s},f}(),u;n.Controller=o;u=function(){function n(n,i,r){if(!n)throw t.argumentNull("controller");if(!i)throw t.argumentNull("name");if(!r)throw t.argumentNull("handle");if(!$.isFunction(r))throw t.paramTypeError("handle","Function");this._name=i;this._handle=r}return n.prototype.name=function(){return this._name},n.prototype.execute=function(n){if(!n)throw t.argumentNull("page");if(n._type!="Page")throw t.paramTypeError("page","Page");var i=this._handle.apply({},[n]);return r.isDeferred(i)?i:$.Deferred().resolve()},n}();n.action=s}(n||(n={})),function(n){var t=function(){function t(t,i,r){this._routeData=new n.RouteData;this._controller=t;this._view=i;this._routeData=r}return t.prototype.controller=function(){return this._controller},t.prototype.view=function(){return this._view},t.prototype.routeData=function(){return this._routeData},t}();n.ControllerContext=t}(n||(n={})),function(n){var t=n.Errors,i=n,r=function(){function n(){this._controllers={};this._controllers={}}return n.prototype.controllers=function(){return this._controllers},n.prototype.createController=function(n){return new i.Controller(n)},n.prototype.actionLocationFormater=function(){return this._actionLocationFormater},n.prototype.getController=function(n){if(!n.values().controller)throw t.routeDataRequireController();return this._controllers[n.values().controller]||(this._controllers[n.values().controller]=this.createController(n.values().controller)),this._controllers[n.values().controller]},n}();n.ControllerFactory=r}(n||(n={})),function(n){var t=function(){function n(n,t,i){this._name=n;this._pattern=t;this._defaults=i}return n.prototype.name=function(){return this._name},n.prototype.defaults=function(){return this._defaults},n.prototype.url=function(){return this._pattern},n}();n.Route=t}(n||(n={})),function(n){var r=n,t=n.Errors,i=function(){function i(){this._init()}return i.prototype._init=function(){var n=window.crossroads;this._source=n.create();this._source.ignoreCase=!0;this._source.normalizeFn=n.NORM_AS_OBJECT;this._priority=0},i.prototype.count=function(){return this._source.getNumRoutes()},i.prototype.mapRoute=function(i){var r,f;i=i||{};var e=i.name,u=i.url,o=i.defaults,s=i.rules||{};if(!e)throw t.argumentNull("name");if(!u)throw t.argumentNull("url");if(this._priority=this._priority+1,r=new n.Route(e,u,o),r.viewPath=i.viewPath,r.actionPath=i.actionPath,r.pageName=i.pageName,f=this._source.addRoute(u,function(){},this._priority),f.rules=s,f.newRoute=r,this._defaultRoute==null){if(this._defaultRoute=r,this._defaultRoute.viewPath==null)throw new Error("default route require view path.");if(this._defaultRoute.actionPath==null)throw new Error("default route require action path.");}return r.viewPath=r.viewPath||this._defaultRoute.viewPath,r.actionPath=r.actionPath||this._defaultRoute.actionPath,r},i.prototype.getRouteData=function(i){var r=this._source.getRouteData(i),e,o,f,s,u;if(r==null)throw t.canntParseUrl(i);for(e={},o=r.route._paramsIds||[],f=0;f<o.length;f++)s=o[f],e[s]=r.params[0][s];return u=new n.RouteData,u.values(e),u.actionPath(r.route.newRoute.actionPath),u.viewPath(r.route.newRoute.viewPath),u.pageName(r.route.newRoute.pageName),u},i.defaultRouteName="default",i}();n.RouteCollection=i}(n||(n={})),function(n){var t=function(){function n(){}return n.prototype.values=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._values=n),this._values},n.prototype.viewPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._viewPath=n),this._viewPath},n.prototype.actionPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._actionPath=n),this._actionPath},n.prototype.pageName=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._pageName=n),this._pageName},n}();n.RouteData=t}(n||(n={})),function(n){function r(n,t){var f="http://".toLowerCase(),r,u;return n.substr(0,f.length).toLowerCase()==f?(r=document.createElement("a"),r.setAttribute("href",n),n=decodeURI(r.pathname),u=i.addRoute(n),f+r.host+u.interpolate(t)):(u=i.addRoute(n),u.interpolate(t))}var t=n.Errors,i=window.crossroads,u=function(){function n(){this._views=[]}return n.prototype.view=function(n){var f;if(!n.values().controller)throw t.routeDataRequireController();if(!n.values().action)throw t.routeDataRequireAction();var u=r(n.viewPath(),n.values()),e=this,i=n.values().controller+"_"+n.values().action;return this._views[i]||(this._views[i]=$.Deferred(),f="http://",u.substr(0,f.length).toLowerCase()==f?$.ajax({url:u}).done($.proxy(function(n){n!=null?this.deferred.resolve(n):this.deferred.reject()},{deferred:this._views[i]})).fail($.proxy(function(n){this.deferred.reject(n)},{deferred:this._views[i]})):require(["text!"+u],$.proxy(function(n){n!=null?this.deferred.resolve(n):this.deferred.reject()},{deferred:this._views[i]}),$.proxy(function(n){this.deferred.reject(n)},{deferred:this._views[i]}))),this._views[i]},n}();n.ViewFactory=u}(n||(n={})),function(n){var i=n,r=n.Utility,t=n.Errors,u=function(){function u(r){if(this.pageCreating=i.Callbacks(),this.pageCreated=i.Callbacks(),this.pageShowing=i.Callbacks(),this.pageShown=i.Callbacks(),this._pages={},this._runned=!1,r==null)throw t.argumentNull("container");if(!r.tagName)throw new Error("Parameter container is not a html element.");this.controllerFactory=new i.ControllerFactory;this.viewFactory=new i.ViewFactory;this._pages={};this._stack=[];this._routes=new n.RouteCollection;this._container=r}return u.prototype.on_pageCreating=function(n){this.pageCreating.fire(this,n)},u.prototype.on_pageCreated=function(n){this.pageCreated.fire(this,n)},u.prototype.on_pageShowing=function(n,t){this.pageShowing.fire(this,n,t)},u.prototype.on_pageShown=function(n,t){this.pageShown.fire(n,t)},u.prototype.routes=function(){return this._routes},u.prototype.controller=function(n){if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");return this.controllerFactory.getController(n)},u.prototype.action=function(n){var r,i,u;if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");if(r=n.controller,!r)throw t.argumentNull("name");if(typeof r!="string")throw t.routeDataRequireController();if(i=n.action,!i)throw t.argumentNull("name");if(typeof i!="string")throw t.routeDataRequireAction();return u=this.controller(n),u.action(i)},u.prototype.run=function(){if(!this._runned){var n=this,t=function(){var t=window.location.hash,i,u;if(!t){r.log("The url is not contains hash.");return}i=window.location.arguments||{};u=window.location.container||n._container;window.location.arguments=null;window.location.container=null;(window.location.skip==null||window.location.skip==!1)&&n.showPageAt(u,t.substr(1),i);window.location.skip=!1};$.proxy(t,this)();$(window).bind("hashchange",$.proxy(t,this));this._runned=!0}},u.prototype.showPageAt=function(n,r,u){var f,e;if(u=u||{},!n)throw t.argumentNull("element");if(!r)throw t.argumentNull("url");return e=this,f=$(n).data("PageContainer"),f==null&&(f=new i.PageContainer(this,n),f.pageCreating.add(function(n,t){e.on_pageCreating(t)}),f.pageCreated.add(function(n,t){e.on_pageCreated(t)}),f.pageShowing.add(function(n,t,i){e.on_pageShowing(t,i)}),f.pageShown.add(function(n,t,i){e.on_pageShown(t,i)}),$(n).data("PageContainer",f)),e=this,f.showPage(r,u)},u.prototype.showPage=function(n,t){return this.showPageAt(this._container,n,t)},u.prototype.redirect=function(n,t){window.location.arguments=t;window.location.hash=n},u.prototype.back=function(n){var t=$(this._container).data("PageContainer");return t==null?$.Deferred().reject():t.back(n)},u}();n.Application=u}(n||(n={})),window.chitu=n,n}),function(n){typeof define=="function"?define(["chitu"],n):n()}(function(){var n=new chitu.Application(document.getElementById("main")),t=/^[a-z]+$/i,i=/^[a-z]+$/i;n.routes().mapRoute({name:"User_Recharge",url:"{controller}_{action}",rules:{controller:i,action:t},viewPath:"../App/Module/{controller}/{action}.html",actionPath:"../App/Module/{controller}/{action}"});n.routes().mapRoute({name:"Shopping_Purchase",url:"{controller}_{action}_{id}",rules:{controller:i,action:t,id:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i}});n.routes().mapRoute({name:"OrderList",url:"{controller}_{action}_{status}",rules:{controller:["Shopping"],action:["OrderList"]}});n.routes().mapRoute({name:"ProductList",url:"{controller}_{action}_{type}_{name}",rules:{controller:i,action:t,type:["category","brand","search"]}});n.routes().mapRoute({name:"UserIndex",url:"{controller}_{action}_{type}",rules:{controller:["User"],action:["Index"]}});return n.back=$.proxy(function(){return window.history.length==0?$.Deferred().reject():(window.history.back(),$.Deferred().resolve())},n),n.pageCreated.add(function(n,t){n.currentPage=t}),window.app=n,n}),function(n){typeof define=="function"?define(["jquery.cookie"],n):n()}(function(){return window.site=window.site||{},site.config={storeName:"零食有约",pageSize:10,defaultUrl:"Index",purchaseUrlFormat:"pay/Purchase.html#{0}"},site.cookies={sourceOpenId:function(n){var t=this.get_cookieName("sourceOpenId");if(n===undefined)return $.cookie(t);$.cookie(t)||$.cookie(t,n,{expires:7})},returnUrl:function(n){var t=this.get_cookieName("returnUrl");if(n===undefined)return this.get_value(t);this.set_value(t,n)},returnUrl_name:function(){return names.returnUrl},appToken:function(n){var t=this.get_cookieName("appToken");if(n===undefined)return $.cookie(t);$.cookie(t,n)},token:function(n){var t=this.get_cookieName("token");if(n===undefined)return $.cookie(t);$.cookie(t,n)},set_value:function(n,t){var i=this.get_cookieName(n);$.cookie(i,t)},get_value:function(n){var t=this.get_cookieName(n);return $.cookie(t)},get_cookieName:function(n){return site.config.cookiePrefix+"_"+n}},site.getAppToken=function(){return site.cookies.appToken()?$.Deferred().resolve(site.cookies.appToken()):$.ajax({url:"Account/GetAppToken"}).then(function(n){return site.cookies.appToken(n.AppToken),n.AppToken})},site}),function(n){typeof define=="function"?define(["knockout","Application"],n):n()}(function(){function f(element,name){var dlg=$(element).attr(name);return dlg?eval("(function(){return {"+dlg+"};})()"):{}}function e(n,t,i,r,u){var e=ko.unwrap(t());return e==null?t:$.proxy(function(){var n=this._element,i=this._valueAccessor,r=this._allBindings,u=this._viewModel,e=this._bindingContext,t=this._value;return function(i){var u=$.Deferred(),r,e;return u.resolve(),r=f(n,"data-dialog"),e=r.content,r.type=="confirm"&&(u=u.pipe(function(){var n=$.Deferred();return require(["text!ko.ext/ComfirmDialog.html"],function(t){var i=$(t).appendTo(document.body).modal()[0],r={text:e,ok:function(){$(i).modal("hide");n.resolve()},cancel:function(){n.reject()}};ko.applyBindings(r,i)}),n})),u.pipe(function(){var u=$.isFunction(t)?t(i,event):t;return u&&$.isFunction(u.always)&&($(n).attr("disabled","disabled"),$(n).addClass("disabled"),u.always(function(){$(n).removeAttr("disabled");$(n).removeClass("disabled")}),setTimeout($.proxy(function(){$(this._element).removeAttr("disabled");$(this._element).removeClass("disabled")},{_element:n}),2e4),u.done(function(){r&&r.type=="toast"&&require(["text!ko.ext/FlashDialog.html"],function(n){var t=$(n).appendTo(document.body).modal()[0],i={text:e};window.setTimeout(function(){$(t).modal("hide");$(t).remove()},1e3);ko.applyBindings(i,t)})})),u})}},{_element:n,_valueAccessor:t,_allBindings:i,_viewModel:r,_bindingContext:u,_value:e})}function t(n){return n.substr(0,1)=="/"&&(n=site.config.imageBaseUrl+n),n}function s(n,t){var f=(t/n).toFixed(2),e="img_log"+f,u=localStorage.getItem(e),r;if(u)return u;var o=320,s=o*new Number(f),i=document.createElement("canvas");return i.width=o,i.height=s,r=i.getContext("2d"),r.fillStyle="whitesmoke",r.fillRect(0,0,i.width,i.height),r.font="Bold 40px Arial",r.textAlign="left",r.fillStyle="#999",r.fillText(site.config.storeName,i.width/2-75,i.height/2),u=i.toDataURL("image/png"),localStorage.setItem(e,u),u}var n,i,r,u,o,l,h,c;return window.ko||(window.ko=arguments[0]),Number.prototype.toFormattedString=function(n){var i=new RegExp("^C[0-9]+"),t;return i.test(n)?(t=n.substr(1),this.toFixed(t)):this},Date.prototype.toFormattedString=function(n){switch(n){case"d":return chitu.Utility.format("{0}-{1}-{2}",this.getFullYear(),this.getMonth()+1,this.getDate());case"g":return chitu.Utility.format("{0}-{1}-{2} {3}:{4}",this.getFullYear(),this.getMonth()+1,this.getDate(),this.getHours(),this.getMinutes());case"G":return chitu.Utility.format("{0}-{1}-{2} {3}:{4}:{5}",this.getFullYear(),this.getMonth()+1,this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds());case"t":return chitu.Utility.format("{0}:{1}",this.getHours(),this.getMinutes());case"T":return chitu.Utility.format("{0}:{1}:{2}",this.getHours(),this.getMinutes(),this.getSeconds())}return n!=null&&$.datepicker!=null?$.datepicker.formatDate(n,this):this.toString()},n=function(n,t){for(var e,f,o,u,c,r,i=1;i<t.length;i++)t[i]=ko.unwrap(t[i]);for(e="",f=t[0],i=0;;){if(o=f.indexOf("{",i),u=f.indexOf("}",i),o<0&&u<0){e+=f.slice(i);break}if(u>0&&(u<o||o<0)){if(f.charAt(u+1)!=="}")throw Error.argument("format","Sys.Res.stringFormatBraceMismatch");e+=f.slice(i,u+1);i=u+2;continue}if(e+=f.slice(i,o),i=o+1,f.charAt(i)==="{"){e+="{";i++;continue}if(u<0)throw Error.argument("format","Sys.Res.stringFormatBraceMismatch");var s=f.substring(i,u),h=s.indexOf(":"),l=parseInt(h<0?s:s.substring(0,h),10)+1;if(isNaN(l))throw Error.argument("format","Sys.Res.stringFormatInvalid");c=h<0?"":s.substring(h+1);r=t[l];(typeof r=="undefined"||r===null)&&(r="");e+=r.toFormattedString?r.toFormattedString(c):n&&r.localeFormat?r.localeFormat(c):r.format?r.format(c):r.toString();i=u+1}return e},i=function(t,i){var r=n(!0,["￥{0:C2}",i()]);t.innerHTML=r},ko.bindingHandlers.money={init:function(n,t){i(n,t)},update:function(n,t){i(n,t)}},r=function(t,i){var r=i(),u;$.isArray(r)?(u=n(!0,r),$(t).attr("href",u)):$(t).attr("href",r)},ko.bindingHandlers.href={init:function(n,t){r(n,t)},update:function(n,t){r(n,t)}},u=function(t,i){var r=i(),u=$.isArray(r)?n(!0,r):r;ko.utils.setTextContent(t,u)},ko.bindingHandlers.text={init:function(n,t){return u(n,t)},update:function(n,t){return u(n,t)}},o=ko.bindingHandlers.click,ko.bindingHandlers.click={init:function(n,t,i,r,u){return t=e(n,t,i,r,u),o.init(n,t,i,r,u)}},l=function(){var u=200,n=0,i=[],r=$.Callbacks();return window.setInterval(function(){if(!(i.length<=0)&&!(n>=u)){var e=i.shift(),f=e.element,o=e.src;f.image=new Image;f.image.element=f;f.image.src=t(o);n=n+1;f.image.onload=function(){this.element.src=this.src;n=n-1;r.fire(this.element)};f.image.onerror=function(){n=n-1}}},100),{load:function(n,t){i.push({element:n,src:t})},imageLoaded:r}}(),h=ko.bindingHandlers.attr,ko.bindingHandlers.attr=function(){return{update:function(n,i,r){if(n.tagName=="IMG"){var e=f(n,"data-image"),u=ko.utils.unwrapObservable(i())||{};ko.utils.objectForEach(u,function(r,f){var h=ko.unwrap(f),o,v;if(r!="src"||!h)return!0;if(o=h.match(/_\d+_\d+/),o&&o.length>0){var c=o[0].split("_"),l=new Number(c[1]).valueOf(),a=new Number(c[2]).valueOf();$(n).attr("width",l+"px");$(n).attr("height",a+"px");(e.showLogo==null||e.showLogo==!0)&&(v=s(l,a));i=$.proxy(function(){var n=ko.utils.unwrapObservable(this._source()),u=ko.unwrap(n.src),r,i;return n.src=this._src,r=this._element,i=new Image,i.onload=function(){r.src=this.src},i.src=t(u),n},{_source:i,_src:v,_element:n})}else u.src=h,i=$.proxy(function(){return this._value},{_value:u})})}return h.update(n,i,r)}}}(),c=ko.bindingHandlers.html,ko.bindingHandlers.html={update:function(n,i,r){var u=c.update(n,i,r),f=$(n).find("img");return f.each(function(){var r=$(this).attr("src"),n,o,i;if($(this).addClass("img-full"),n=r.match(/_\d+_\d+/),n&&n.length>0){var u=n[0].split("_"),f=new Number(u[1]).valueOf(),e=new Number(u[2]).valueOf();$(this).attr("width",f+"px");$(this).attr("height",e+"px");o=s(f,e);$(this).attr("src",o);i=new Image;i.element=this;i.onload=function(){$(this.element).attr("src",this.src)};i.src=t(r)}else $(this).attr("src",t(r))}),u}},ko.bindingHandlers.tap={init:function(n,t,i,r,u){t=e(n,t,i,r,u);$(n).on("tap",$.proxy(function(n){this._valueAccessor()(r,n)},{_valueAccessor:t}))}},ko}),function(n){typeof define=="function"?define(["jquery","app/Application"],n):n()}(function(n){function t(){i.hide();n("#main").show()}var i=n("#loadingForm");app.pageCreated.add(function(r,u){u.showing.add(function(){window.bootbox&&bootbox.hideAll();n("#main").hide();i.show()});u.shown.add(t)});app.currentPage!=null&&(app.currentPage.shown.add(t),app.currentPage.visible()&&t())}),function(n){typeof define=="function"&&define.amd?define(["knockout","jquery.cookie","knockout.mapping","app/Rewrite","app/Site"],n):n()}(function(){var t,i,n;return arguments.length>0&&(window.ko=arguments[0],ko.mapping=arguments[2]),t="token",i="username",window.models={},n={error:$.Callbacks(),callRemoteMethod:function(n,t){var i;if(t=t||{},i=site.config.serviceUrl,i==null)throw new Error("The service url is not setted.");var r=i+n,f=$.Deferred(),t=$.extend({$token:site.cookies.token(),$appToken:site.cookies.appToken()},t),u={url:r,data:t,method:"post",dataType:"json",traditional:!0};return $.ajax(u)}},window.services=window.services||n,n}),function(n){if(typeof define=="function"&&define.amd){var t=[];window.services||t.push("sv/Services");define(t,n)}else n()}(function(){function n(n,t){t=t||{};var i=site.config.memberServiceUrl+n;return site.getAppToken().pipe($.proxy(function(n){return this._data.$appToken=n,this._data.$token=site.cookies.token(),$.ajax({url:i,data:this._data,method:"get",dataType:"json"})},{_data:t}))}window.services.member={logouted:$.Callbacks(),logined:$.Callbacks(),login:function(t,i){return n("Member/Login",{username:t,password:i}).then(function(n){return site.cookies.token(n.UserToken),n}).done($.proxy(function(n){$.extend(n,{UserName:this._username,Password:this._password});services.member.logined.fire(n)},{_username:t,_password:i}))},isLogined:function(){var n=site.cookies.token()!=null&&site.cookies.token()!="";return $.Deferred().resolve(n)},sendRegisterVerifyCode:function(t){return n("Member/SendVerifyCode",{mobile:t,type:"Register"}).then(function(n){return n.SmsId})},register:function(t,i,r){if(t==null)throw Error.argumentNull("user");var u=ko.mapping.toJS(t);return u.verifyCode=i,u.smsId=r,n("Member/Register",u)},getUserInfo:function(){return n("UserInfo/Get").then(function(n){return n=n||{},n.HeadImageUrl=n.HeadImageUrl||"Content/images/nophoto.png",n.NickName,n})},setUserInfo:function(t){return n("UserInfo/Set",t)},changePassword:function(t){return n("Member/ChangePassword",{password:t})}}}),function(n){if(typeof define=="function"&&define.amd){var t=[];window.services||t.push("sv/Services");define(t,n)}else n()}(function(){var n=function(n){var t={};for(var i in n)t[i]=ko.observable(n[i]);return t.Amount=ko.computed(function(){return ko.unwrap(this.Price)*ko.unwrap(this.Count)},t),t};return services.shoppingCart={_items:[],itemAdded:$.Callbacks(),itemRemoved:$.Callbacks(),itemUpdated:$.Callbacks(),getItem:function(n){for(var i=$.Deferred(),t=0;t<this._items.length;t++)if(ko.unwrap(this._items[t].ProductId)==n)return i.resolve(this._items[t]);return i.reject()},addItem:function(n,t){var r=this,i=ko.unwrap(n.Id);return services.callRemoteMethod("ShoppingCart/AddItem",{productId:i,count:t})},updateItem:function(n){var t=this,i=ko.unwrap(n.ProductId),r=ko.unwrap(n.Count),u=ko.unwrap(n.Selected);return services.callRemoteMethod("ShoppingCart/UpdateItem",{productId:i,count:r,selected:u}).done($.proxy(function(n){return t.getItem(this._productId).done(function(n){t.itemUpdated.fire(n)}),n},{_productId:i,_count:r,_selected:u}))},removeItem:function(n){var t=ko.unwrap(n.ProductId);return this.removeItems([t])},removeItems:function(n){var t=this;return services.callRemoteMethod("ShoppingCart/RemoveItems",{productIds:n}).done($.proxy(function(){for(var r,u,i=[],n=0;n<this._productIds.length;n++)for(r=0;r<t._items.length;r++)this._productIds[n]==ko.unwrap(t._items[r].ProductId)&&i.push(t._items[r]);for(u=$.grep(t._items,function(n){for(var t=0;t<i.length;t++)if(ko.unwrap(i[t].Id)==ko.unwrap(n.Id))return!1;return!0}),t._items=u,n=0;n<i.length;n++)t.itemRemoved.fire(i[n])},{_productIds:n}))},getItems:function(){if(this._loaded)return $.Deferred().resolve(this._items);if(this._getItemsResult)return this._getItemsResult;var n=this;return this._getItemsResult=services.callRemoteMethod("ShoppingCart/GetItems",{}),this._getItemsResult.always(function(){n._getItemsResult=null}),this._getItemsResult},getProductsCount:function(){var n=$.Deferred();return this.getItems().done(function(t){for(var i=0,r=0;r<t.length;r++)i=i+new Number(ko.unwrap(t[r].Count));n.resolve(i)}),n},clear:function(){return services.callRemoteMethod("ShoppingCart/ClearItems")}},services}),function(n){if(typeof requirejs=="function"&&define.amd){var t=[];window.services||t.push("sv/Services");requirejs(t,n)}else n()}(function(){var n=$.ajax;$.extend($,{ajax:function(t){t.data=t.data||{};var i=$.Deferred();return n(t).done($.proxy(function(n,t,i){if(n.Type=="ErrorObject"){if(n.Code=="Success"){this._result.resolve(n,t,i);return}services.error.fire(n,t,i);this._result.reject(n,t,i);return}this._result.resolve(n,t,i)},{_result:i})).fail($.proxy(function(n,t){var i={Code:t};services.error.fire(i);this._result.reject(i)},{_result:i})),i}}),function(){function t(t){var i=n.length,r=t.length-n.length-2,u=t.substr(i,r),f=parseInt(u);return new Date(f)}var n="/Date(";$.ajaxSettings.converters["text json"]=function(i){var u=$.parseJSON(i),f,e,s,r,o;if(typeof u=="string")return u.substr(0,n.length)==n&&(u=t(u)),u;for(f=[],f.push(u);f.length>0;){e=f.pop();for(s in e)if(r=e[s],r!=null){if($.isArray(r)){for(o=0;o<r.length;o++)f.push(r[o]);continue}if($.isPlainObject(r)){f.push(r);continue}typeof r=="string"&&r.substr(0,n.length)==n&&(e[s]=t(r))}}return u}}()}),function(n){if(typeof define=="function")define(["jquery","app/Site","app/Application"],n);else n()}(function(n){function f(){var t=n(".menu");t.is(":visible")&&(n(".menu").hide(),site.menu.visibleChanged.fire({menu:t[0],visible:!1}))}function e(){var t=n(".menu");t.is(":visible")||(t.show(),site.menu.visibleChanged.fire({menu:t[0],visible:!0}))}function o(t){u.done(function(){n(site.buttonBar.element()).find(".glyphicon-shopping-cart, .glyphicon-home, .glyphicon-menu-left").parent().hide();switch(t){case"Home.Product":n(site.buttonBar.element()).find(".glyphicon-shopping-cart").parent().show();n(site.buttonBar.element()).show()}})}function s(){n(site.buttonBar.element()).hide()}var i,t,r,u;site.menu={isVisible:function(){return n(".menu").is(":visible")},visibleChanged:n.Callbacks(),height:function(){return n(".menu").height()}};site.buttonBar={element:function(){return n("#footer").find('[name="bttonBar"]')[0]},isVisible:function(){return n("#footer").find('[name="bttonBar"]').is(":visible")},back:n.Callbacks()};i=function(t,i){var u=t,c,h,r;s();c=n(".menu");h=n(document.getElementById(i.controller+"_"+i.action));h.length>0&&(c.find("a").removeClass("active"),h.addClass("active"));r=u.name();r=="Home.Index"||r=="Home.Class"||r=="Home.NewsList"||r=="Shopping.ShoppingCart"||r=="User.Index"?(e(r),u.node().style.marginBottom=site.menu.height+"px"):(f(r),o(r),u.node().style.marginBottom="0px")};app.pageCreated.add(function(n,t){t.showing.add(i)});t={productsCount:ko.observable(0),visible:ko.observable(!0),shoppingCart:function(){return site.cookies.token()?app.redirect("Shopping_ShoppingCart"):app.redirect("User_Login",{redirectUrl:"Shopping_ShoppingCart"})},userIndex:function(){return site.cookies.token()?app.redirect("User_Index"):app.redirect("User_Login",{redirectUrl:"User_Index"})}},function(n){if(typeof requirejs=="function"){var t=[];window.services&&services.member||t.push("sv/Member");window.services&&services.shoppingCart||t.push("sv/ShoppingCart");requirejs(t,n)}else n()}(function(){services.member.logined.add(function(){services.shoppingCart.getProductsCount().done(function(n){t.productsCount(n)})});services.member.logouted.add(function(){t.productsCount(0)});services.member.isLogined().pipe(function(t){return t?services.shoppingCart.getProductsCount():n.Deferred().reject()}).done(function(n){t.productsCount(n)});var i=function(){services.shoppingCart.getProductsCount().done(function(n){t.productsCount(n)})};services.shoppingCart.itemAdded.add(i);services.shoppingCart.itemRemoved.add(i);services.shoppingCart.itemUpdated.add(i)});r=document.createElement("div");n(r).insertAfter(n("#main"));u=n.ajax("App/UI/Menu.html").done(function(i){r.innerHTML=i;n(site.buttonBar.element()).find(".glyphicon-menu-left").on("click",function(){site.buttonBar.back.fire({})});n(site.buttonBar.element()).find(".glyphicon-home").on("click",function(){app.redirect("Home_Index")});n(site.buttonBar.element()).find(".glyphicon-shopping-cart").on("click",function(){app.redirect("Shopping_ShoppingCart")});ko.applyBindings(t,r)});u.done(function(){app.currentPage!=null&&(app.currentPage.showing.add(i),i(app.currentPage,app.currentPage.context().routeData().values()))})});define(["sv/Services","app/Application"],function(){function n(n){window.bootbox?bootbox.alert(n):window.alert(n)}function t(t){var i;if(t.Code)switch(t.Code){case"PasswordIncorect":i="用户名或密码不正确";break;case"NotLogin":i="尚未登录";break;case"AllCouponsReceived":i="优惠券已经领取完毕";break;case"MemberExists":i="该会员已经存在";break;case"MemberNotExists":i="该会员不存在";break;case"EmailExists":i="该邮箱已经注册";break;case"User":i="提示："+t.Message;break;default:i=t.Message?t.Message:chitu.Utility.format("未知的错误(Code:{0},{1})",t.Code,t.Message||"")}else if(t.status)switch(t.status){case 404:i="您的网络不佳，请稍后再试";return;default:i=t.Message?t.Message:chitu.Utility.format("未知的错误(Code:{0},{1})",t.Code,t.Message||"")}else i="未知的错误("+t.url+")";n(i);return}services.error.add(function(n){if(n.Code=="NotLogin"||n.Code=="TokenRequired"){var i="";return location.hash.length>1&&(i=location.hash.substr(1)),app.redirect("User_Login",{redirectUrl:i})}t(n)});require(["bootbox"],function(n){window.bootbox=n})}),function(n){if(typeof define=="function"&&define.amd){var t=[];window.services||t.push("sv/Services");define(t,n)}else n()}(function(){function n(n){var t=ko.mapping.fromJS(n),i=t.OrderDetails(),r;for(t.OrderDetails=ko.observableArray(),r=0;r<i.length;r++)i[r].Amount=ko.computed(function(){return this.Price()*this.Quantity()},i[r]),t.OrderDetails.push(i[r]);return t.ProductsAmount=ko.computed(function(){for(var n=0,t=0;t<i.length;t++)n=n+i[t].Amount();return n},t),t.StatusText=ko.computed(function(){var n=this.Status();switch(n){case"WaitingForPayment":return"待付款";case"Paid":return"已付款";case"Send":return"已发货";case"Canceled":return"已取消";case"Finish":return"已完成";case"Received":return"已收货";default:return""}},t),t.ReceiptInfoId=ko.observable(),t.ReceiptAddress.extend({required:{message:"请填写收货信息"}}),t}return services.shopping={getCategories:function(n){return services.callRemoteMethod("Product/GetCategories",{parentName:n})},getCategory:function(n){return services.callRemoteMethod("Product/GetCategory",{categoryId:n})},getProductsByCategory:function(n){return services.callRemoteMethod("Product/GetProducts",{categoryName:n},translators.product)},getProductsByBrand:function(n){return services.callRemoteMethod("Product/GetProducts",{brand:n},translators.product)},getProduct:function(n){return services.callRemoteMethod("Product/GetProduct",{productId:n}).then(function(n){return n.ImageUrls=(n.ImageUrl||"").split(","),n.ImageUrl=n.ImageUrls[0],n})},getProducts:function(n){var t=$.Deferred();return services.callRemoteMethod("Product/GetProducts",n).then($.proxy(function(n){return this._result.loadCompleted=n.Products.length<site.config.pageSize,n},{_result:t})).fail($.proxy(function(n){this._result.reject(n)},{_result:t})).done($.proxy(function(n){var t=n.Products,i=n.Filters;this._result.resolve(t,i)},{_result:t})),t},findProductsByName:function(n){return services.callRemoteMethod("Product/FindProducts",{name:n},translators.product)},createOrder:function(t,i){return services.callRemoteMethod("Order/CreateOrder",{productIds:t,quantities:i}).then(function(t){return n(t)})},getOrder:function(t){return services.callRemoteMethod("Order/GetOrder",{orderId:t}).then(function(t){return n(t)})},confirmOrder:function(n){return services.callRemoteMethod("Order/ConfirmOrder",n)},useCoupon:function(n,t){return services.callRemoteMethod("Order/UseCoupon",{orderId:n,couponCode:t})},getMyOrders:function(t,i,r){var u=[],e,o;t&&u.push('Status=="'+t+'"');r&&(e=r.getMilliseconds(),o=r.toFormattedString("G")+"."+e,u.push("CreateDateTime < #"+o+"#"));var s=u.join(" && "),h={filter:s,StartRowIndex:i*site.config.pageSize,MaximumRows:site.config.pageSize},f=services.callRemoteMethod("Order/GetMyOrders",h).then(function(t){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t});return f.done($.proxy(function(n){this._result.loadCompleted=n.length<site.config.pageSize},{_result:f})),f},getMyLastestOrders:function(t,i){var u,r;return i&&(r=i.getMilliseconds(),i=i.toFormattedString("G")+"."+r),services.callRemoteMethod("Order/GetMyLastestOrders",{dateTime:u,status:t}).then(function(t){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t})},getBrands:function(n){return services.callRemoteMethod("Product/GetBrands",n).then(function(n){return n})},getBrand:function(n){return services.callRemoteMethod("Product/GetBrand",{brandId:n})},getShippingInfo:function(n){return services.callRemoteMethod("Product/GetShippingInfo",{orderId:n})},changeReceipt:function(n,t){return services.callRemoteMethod("Order/ChangeReceipt",{orderId:n,receiptId:t})},getPrepayId:function(n,t,i,r,u){return services.weixin.getPrepayId(n,t,i,r,u)},allowPurchase:function(n){return services.callRemoteMethod("Order/AllowPurchase",{orderId:n})},getProductStock:function(n){return services.callRemoteMethod("Stock/GetProductStock",{productId:n})},balancePay:function(n,t){return services.callRemoteMethod("Order/BalancePay",{orderId:n,amount:t})}},services});+function(n){"use strict";function i(i,r){return this.each(function(){var f=n(this),u=f.data("bs.modal"),e=n.extend({},t.DEFAULTS,f.data(),typeof i=="object"&&i);u||f.data("bs.modal",u=new t(this,e));typeof i=="string"?u[i](r):e.show&&u.show(r)})}var t=function(t,i){this.options=i;this.$body=n(document.body);this.$element=n(t);this.$dialog=this.$element.find(".modal-dialog");this.$backdrop=null;this.isShown=null;this.originalBodyPad=null;this.scrollbarWidth=0;this.ignoreBackdropClick=!1;this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,n.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))},r;t.VERSION="3.3.5";t.TRANSITION_DURATION=300;t.BACKDROP_TRANSITION_DURATION=150;t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0};t.prototype.toggle=function(n){return this.isShown?this.hide():this.show(n)};t.prototype.show=function(i){var r=this,u=n.Event("show.bs.modal",{relatedTarget:i});if(this.$element.trigger(u),!this.isShown&&!u.isDefaultPrevented()){this.isShown=!0;this.checkScrollbar();this.setScrollbar();this.$body.addClass("modal-open");this.escape();this.resize();this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',n.proxy(this.hide,this));this.$dialog.on("mousedown.dismiss.bs.modal",function(){r.$element.one("mouseup.dismiss.bs.modal",function(t){n(t.target).is(r.$element)&&(r.ignoreBackdropClick=!0)})});this.backdrop(function(){var f=n.support.transition&&r.$element.hasClass("fade"),u;r.$element.parent().length||r.$element.appendTo(r.$body);r.$element.show().scrollTop(0);r.adjustDialog();f&&r.$element[0].offsetWidth;r.$element.addClass("in");r.enforceFocus();u=n.Event("shown.bs.modal",{relatedTarget:i});f?r.$dialog.one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(u)}).emulateTransitionEnd(t.TRANSITION_DURATION):r.$element.trigger("focus").trigger(u)})}};t.prototype.hide=function(i){(i&&i.preventDefault(),i=n.Event("hide.bs.modal"),this.$element.trigger(i),this.isShown&&!i.isDefaultPrevented())&&(this.isShown=!1,this.escape(),this.resize(),n(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),n.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",n.proxy(this.hideModal,this)).emulateTransitionEnd(t.TRANSITION_DURATION):this.hideModal())};t.prototype.enforceFocus=function(){n(document).off("focusin.bs.modal").on("focusin.bs.modal",n.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||this.$element.trigger("focus")},this))};t.prototype.escape=function(){if(this.isShown&&this.options.keyboard)this.$element.on("keydown.dismiss.bs.modal",n.proxy(function(n){n.which==27&&this.hide()},this));else this.isShown||this.$element.off("keydown.dismiss.bs.modal")};t.prototype.resize=function(){if(this.isShown)n(window).on("resize.bs.modal",n.proxy(this.handleUpdate,this));else n(window).off("resize.bs.modal")};t.prototype.hideModal=function(){var n=this;this.$element.hide();this.backdrop(function(){n.$body.removeClass("modal-open");n.resetAdjustments();n.resetScrollbar();n.$element.trigger("hidden.bs.modal")})};t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null};t.prototype.backdrop=function(i){var e=this,f=this.$element.hasClass("fade")?"fade":"",r,u;if(this.isShown&&this.options.backdrop){r=n.support.transition&&f;this.$backdrop=n(document.createElement("div")).addClass("modal-backdrop "+f).appendTo(this.$body);this.$element.on("click.dismiss.bs.modal",n.proxy(function(n){if(this.ignoreBackdropClick){this.ignoreBackdropClick=!1;return}n.target===n.currentTarget&&(this.options.backdrop=="static"?this.$element[0].focus():this.hide())},this));if(r&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!i)return;r?this.$backdrop.one("bsTransitionEnd",i).emulateTransitionEnd(t.BACKDROP_TRANSITION_DURATION):i()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),u=function(){e.removeBackdrop();i&&i()},n.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",u).emulateTransitionEnd(t.BACKDROP_TRANSITION_DURATION):u()):i&&i()};t.prototype.handleUpdate=function(){this.adjustDialog()};t.prototype.adjustDialog=function(){var n=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&n?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!n?this.scrollbarWidth:""})};t.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})};t.prototype.checkScrollbar=function(){var n=window.innerWidth,t;n||(t=document.documentElement.getBoundingClientRect(),n=t.right-Math.abs(t.left));this.bodyIsOverflowing=document.body.clientWidth<n;this.scrollbarWidth=this.measureScrollbar()};t.prototype.setScrollbar=function(){var n=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";this.bodyIsOverflowing&&this.$body.css("padding-right",n+this.scrollbarWidth)};t.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)};t.prototype.measureScrollbar=function(){var n=document.createElement("div"),t;return n.className="modal-scrollbar-measure",this.$body.append(n),t=n.offsetWidth-n.clientWidth,this.$body[0].removeChild(n),t};r=n.fn.modal;n.fn.modal=i;n.fn.modal.Constructor=t;n.fn.modal.noConflict=function(){return n.fn.modal=r,this};n(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var r=n(this),f=r.attr("href"),u=n(r.attr("data-target")||f&&f.replace(/.*(?=#[^\s]+$)/,"")),e=u.data("bs.modal")?"toggle":n.extend({remote:!/#/.test(f)&&f},u.data(),r.data());r.is("a")&&t.preventDefault();u.one("show.bs.modal",function(n){if(!n.isDefaultPrevented())u.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})});i.call(u,e,this)})}(jQuery),function(n,t){"use strict";typeof define=="function"&&define.amd?define(["jquery"],t):typeof exports=="object"?module.exports=t(require("jquery")):n.bootbox=t(n.jQuery)}(this,function init(n,t){"use strict";function a(n){var t=o[f.locale];return t?t[n]:o.en[n]}function e(t,i,r){t.stopPropagation();t.preventDefault();var u=n.isFunction(r)&&r(t)===!1;u||i.modal("hide")}function v(n){var i,t=0;for(i in n)t++;return t}function r(t,i){var r=0;n.each(t,function(n,t){i(n,t,r++)})}function y(t){var i,u;if(typeof t!="object")throw new Error("Please supply an object of options");if(!t.message)throw new Error("Please specify a message");return t=n.extend({},f,t),t.buttons||(t.buttons={}),t.backdrop=t.backdrop?"static":!1,i=t.buttons,u=v(i),r(i,function(t,r,f){if(n.isFunction(r)&&(r=i[t]={callback:r}),n.type(r)!=="object")throw new Error("button with key "+t+" must be an object");r.label||(r.label=t);r.className||(r.className=u<=2&&f===u-1?"btn-primary":"btn-default")}),t}function p(n,t){var r=n.length,i={};if(r<1||r>2)throw new Error("Invalid argument length");return r===2||typeof n[0]=="string"?(i[t[0]]=n[0],i[t[1]]=n[1]):i=n[0],i}function s(t,i,r){return n.extend(!0,{},t,p(i,r))}function h(n,t,i,r){var u={className:"bootbox-"+n,buttons:c.apply(null,t)};return l(s(u,r,i),t)}function c(){for(var t={},n=0,r=arguments.length;n<r;n++){var i=arguments[n],u=i.toLowerCase(),f=i.toUpperCase();t[u]={label:a(f)}}return t}function l(n,i){var u={};return r(i,function(n,t){u[t]=!0}),r(n.buttons,function(n){if(u[n]===t)throw new Error("button key "+n+" is not allowed (options are "+i.join("\n")+")");}),n}var u={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'><\/div><\/div><\/div><\/div><\/div>",header:"<div class='modal-header'><h4 class='modal-title'><\/h4><\/div>",footer:"<div class='modal-footer'><\/div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;<\/button>",form:"<form class='bootbox-form'><\/form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'><\/textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'><\/select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /><\/label><\/div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},f={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0,container:"body"},i={},o;return i.alert=function(){var t;if(t=h("alert",["ok"],["message","callback"],arguments),t.callback&&!n.isFunction(t.callback))throw new Error("alert requires callback property to be a function when provided");return t.buttons.ok.callback=t.onEscape=function(){return n.isFunction(t.callback)?t.callback():!0},i.dialog(t)},i.confirm=function(){var t;if(t=h("confirm",["cancel","confirm"],["message","callback"],arguments),t.buttons.cancel.callback=t.onEscape=function(){return t.callback(!1)},t.buttons.confirm.callback=function(){return t.callback(!0)},!n.isFunction(t.callback))throw new Error("confirm requires a callback");return i.dialog(t)},i.prompt=function(){var f,p,h,v,e,w,o,b,y,a,k;if(v=n(u.form),p={className:"bootbox-prompt",buttons:c("cancel","confirm"),value:"",inputType:"text"},f=l(s(p,arguments,["title","callback"]),["cancel","confirm"]),w=f.show===t?!0:f.show,b=["date","time","number"],y=document.createElement("input"),y.setAttribute("type",f.inputType),b[f.inputType]&&(f.inputType=y.type),f.message=v,f.buttons.cancel.callback=f.onEscape=function(){return f.callback(null)},f.buttons.confirm.callback=function(){var t,i;switch(f.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":t=e.val();break;case"checkbox":i=e.find("input:checked");t=[];r(i,function(i,r){t.push(n(r).val())})}return f.callback(t)},f.show=!1,!f.title)throw new Error("prompt requires a title");if(!n.isFunction(f.callback))throw new Error("prompt requires a callback");if(!u.inputs[f.inputType])throw new Error("invalid prompt type");e=n(u.inputs[f.inputType]);switch(f.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":e.val(f.value);break;case"select":if(a={},o=f.inputOptions||[],!o.length)throw new Error("prompt with select requires options");r(o,function(i,r){var u=e;if(r.value===t||r.text===t)throw new Error("given options in wrong format");r.group&&(a[r.group]||(a[r.group]=n("<optgroup/>").attr("label",r.group)),u=a[r.group]);u.append("<option value='"+r.value+"'>"+r.text+"<\/option>")});r(a,function(n,t){e.append(t)});e.val(f.value);break;case"checkbox":if(k=n.isArray(f.value)?f.value:[f.value],o=f.inputOptions||[],!o.length)throw new Error("prompt with checkbox requires options");if(!o[0].value||!o[0].text)throw new Error("given options in wrong format");e=n("<div/>");r(o,function(t,i){var o=n(u.inputs[f.inputType]);o.find("input").attr("value",i.value);o.find("label").append(i.text);r(k,function(n,t){t===i.value&&o.find("input").prop("checked",!0)});e.append(o)})}f.placeholder&&e.attr("placeholder",f.placeholder);f.pattern&&e.attr("pattern",f.pattern);v.append(e);v.on("submit",function(n){n.preventDefault();h.find(".btn-primary").click()});h=i.dialog(f);h.off("shown.bs.modal");h.on("shown.bs.modal",function(){e.focus()});return w===!0&&h.modal("show"),h},i.dialog=function(t){var h;t=y(t);var i=n(u.dialog),o=i.find(".modal-body"),c=t.buttons,s="",f={onEscape:t.onEscape};r(c,function(n,t){s+="<button data-bb-handler='"+n+"' type='button' class='btn "+t.className+"'>"+t.label+"<\/button>";f[n]=t.callback});o.find(".bootbox-body").html(t.message);t.animate===!0&&i.addClass("fade");t.className&&i.addClass(t.className);t.title&&o.before(u.header);t.closeButton&&(h=n(u.closeButton),t.title?i.find(".modal-header").prepend(h):h.css("margin-top","-10px").prependTo(o));t.title&&i.find(".modal-title").html(t.title);s.length&&(o.after(u.footer),i.find(".modal-footer").html(s));i.on("hidden.bs.modal",function(n){n.target===this&&i.remove()});i.on("shown.bs.modal",function(){i.find(".btn-primary:first").focus()});i.on("escape.close.bb",function(n){f.onEscape&&e(n,i,f.onEscape)});i.on("click",".modal-footer button",function(t){var r=n(this).data("bb-handler");e(t,i,f[r])});i.on("click",".bootbox-close-button",function(n){e(n,i,f.onEscape)});i.on("keyup",function(n){n.which===27&&i.trigger("escape.close.bb")});return n(t.container).append(i),i.modal({backdrop:t.backdrop,keyboard:!1,show:!1}),t.show&&i.modal("show"),i},i.setDefaults=function(){var t={};arguments.length===2?t[arguments[0]]=arguments[1]:t=arguments[0];n.extend(f,t)},i.hideAll=function(){n(".bootbox").modal("hide")},o={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}},i.init=function(t){return init(t||n)},i}),function(n){typeof define=="function"&&define.amd?define(["bootbox"],n):n(window.bootbox)}(function(n){return n.setDefaults({locale:"zh_CN"}),window.bootbox=n,n});define.amd=_amd;
//# sourceMappingURL=prequire.min.js.map
