function scrollEndCheck(n){checking_num==null&&(checking_num=0,checking_num=window.setInterval(function(){if(pre_scroll_top==cur_scroll_args.scrollTop){window.clearInterval(checking_num);checking_num=null;pre_scroll_top=null;n.on_scrollEnd(cur_scroll_args);return}pre_scroll_top=cur_scroll_args.scrollTop},CHECK_INTERVAL))}var DocumentScroll,IOSScroll,chitu;(function(n){var t=n.Errors,i=function(){function n(){}return n.isType=function(n,t){for(var i in n.prototype)if(t[i]===undefined)return!1;return!0},n.isDeferred=function(n){return n==null?!1:n.pipe!=null&&n.always!=null&&n.done!=null?!0:!1},n.format=function(n,t,i,r,u,f,e,o,s,h,c){for(var a=[t,i,r,u,f,e,o,s,h,c],l=0;l<a.length;l++){if(a[l]==null)break;n=n.replace(new RegExp("\\{"+l+"\\}","g"),function(){return a[l]})}return n},n.fileName=function(n,i){var r,u;if(!n)throw t.argumentNull("url");return i=i||!0,n=n.replace("http://","/"),r=n.replace(/^.*[\\\/]/,""),i===!0&&(u=r.split("."),r=u[0]),r},n.log=function(n,t){if(t===void 0&&(t=[]),window.console){if(t==null){console.log(n);return}var i=this.format.apply(this,arguments);console.log(i)}},n.loadjs=function(n){var t=$.Deferred();return requirejs(n,function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t.resolve.apply(t,i)}),t},n}();n.Utility=i})(chitu||(chitu={})),function(n){var t=n.Utility,i=function(){function n(){}return n.argumentNull=function(n){var i=t.format('The argument "{0}" cannt be null.',n);return new Error(i)},n.modelFileExpecteFunction=function(n){var i=t.format('The eval result of script file "{0}" is expected a function.',n);return new Error(i)},n.paramTypeError=function(n,i){var r=t.format('The param "{0}" is expected "{1}" type.',n,i);return new Error(r)},n.viewNodeNotExists=function(n){var i=t.format('The view node "{0}" is not exists.',n);return new Error(i)},n.pathPairRequireView=function(n){var i=t.format('The view value is required for path pair, but the item with index "{0}" is miss it.',n);return new Error(i)},n.notImplemented=function(n){var i=t.format('The method "{0}" is not implemented.',n);return new Error(i)},n.routeExists=function(n){var i=t.format('Route named "{0}" is exists.',n);return new Error(i)},n.routeResultRequireController=function(n){var i=t.format('The parse result of route "{0}" does not contains controler.',n);return new Error(i)},n.routeResultRequireAction=function(n){var i=t.format('The parse result of route "{0}" does not contains action.',n);return new Error(i)},n.ambiguityRouteMatched=function(n,i,r){var u=t.format("Ambiguity route matched, {0} is match in {1} and {2}.",n,i,r);return new Error(u)},n.noneRouteMatched=function(n){var i=t.format('None route matched with url "{0}".',n);return new Error(i)},n.emptyStack=function(){return new Error("The stack is empty.")},n.canntParseUrl=function(n){var i=t.format('Can not parse the url "{0}" to route data.',n);return new Error(i)},n.routeDataRequireController=function(){return new Error('The route data does not contains a "controller" file.')},n.routeDataRequireAction=function(){return new Error('The route data does not contains a "action" file.')},n.parameterRequireField=function(n,i){var r=t.format("Parameter {1} does not contains field {0}.",n,i);return new Error(r)},n.viewCanntNull=function(){return new Error("The view or viewDeferred of the page cannt null.")},n}();n.Errors=i}(chitu||(chitu={})),function(n){function u(n){var t=i[n]={};return jQuery.each(n.match(r)||[],function(n,i){t[i]=!0}),t}function e(t){t===void 0&&(t=null);t=typeof t=="string"?i[t]||u(t):jQuery.extend({},t);var e,l,h,a,o,s,r=[],f=!t.once&&[],v=function(n){for(e=t.memory&&n,l=!0,s=a||0,a=0,o=r.length,h=!0;r&&s<o;s++){var i=r[s].apply(n[0],n[1]);if(i!=null&&n[0].results.push(i),i===!1&&t.stopOnFalse){e=!1;break}}h=!1;r&&(f?f.length&&v(f.shift()):e?r=[]:c.disable())},c={results:[],add:function(){if(r){var n=r.length;(function i(n){jQuery.each(n,function(n,u){var f=jQuery.type(u);f==="function"?t.unique&&c.has(u)||r.push(u):u&&u.length&&f!=="string"&&i(u)})})(arguments);h?o=r.length:e&&(a=n,v(e))}return this},remove:function(){return r&&jQuery.each(arguments,function(n,t){for(var i;(i=jQuery.inArray(t,r,i))>-1;)r.splice(i,1),h&&(i<=o&&o--,i<=s&&s--)}),this},has:function(n){return n?jQuery.inArray(n,r)>-1:!!(r&&r.length)},empty:function(){return r=[],o=0,this},disable:function(){return r=f=e=undefined,this},disabled:function(){return!r},lock:function(){return f=undefined,e||c.disable(),this},locked:function(){return!f},fireWith:function(n,t){return n.results=[],r&&(!l||f)&&(t=t||[],t=[n,t.slice?t.slice():t],h?f.push(t):v(t)),n.results},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!l},count:function(){return r.length}};return new n.Callback(c)}function o(t,i){for(var u=t.fire.apply(t,i),f=[],r=0;r<u.length;r++)n.Utility.isDeferred(u[r])&&f.push(u[r]);return f.length==0?$.Deferred().resolve():$.when.apply($,f)}var r=/\S+/g,i={},f=function(){function n(n){this.source=n}return n.prototype.add=function(n){this.source.add(n)},n.prototype.remove=function(n){this.source.remove(n)},n.prototype.has=function(n){return this.source.has(n)},n.prototype.fireWith=function(n,t){return this.source.fireWith(n,t)},n.prototype.fire=function(n,t,i){return this.source.fire(n,t,i)},n}(),t;n.Callback=f;n.Callbacks=e;n.fireCallback=o;t=window.crossroads;$.extend(t,{_create:t.create,create:function(){var t=this._create();return t.getRouteData=function(t,i){if(t=t||"",i=i||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var r=this._getMatchedRoutes(t),u=r.length;if(u==0)return null;if(u>1)throw n.Errors.ambiguityRouteMatched(t,"route1","route2");return r[0]}},t}})}(chitu||(chitu={})),function(n){function r(n,t){var f="http://".toLowerCase(),r,u;return n.substr(0,f.length).toLowerCase()==f?(r=document.createElement("a"),r.setAttribute("href",n),n=decodeURI(r.pathname),u=i.addRoute(n),f+r.host+u.interpolate(t)):(u=i.addRoute(n),u.interpolate(t))}function f(i){var e=i.values().action,o,f;if(!e)throw t.routeDataRequireAction();return o=r(i.actionPath(),i.values()),f=$.Deferred(),requirejs([o],function(t){var r,o;if(t||(console.warn(n.Utility.format("加载活动“{1}.{0}”失败。",e,i.values().controller)),f.reject()),r=t.func||t,!$.isFunction(r))throw n.Errors.modelFileExpecteFunction(e);o=new u(self,e,r);f.resolve(o)},function(n){return f.reject(n)}),f}function e(n){if(!n.values().controller)throw t.routeDataRequireController();if(!n.values().action)throw t.routeDataRequireAction();var u=r(n.viewPath(),n.values()),e=this,i=$.Deferred(),f="http://";return u.substr(0,f.length).toLowerCase()==f?$.ajax({url:u}).done(function(n){n!=null?i.resolve(n):i.reject()}).fail(function(n){return i.reject(n)}):requirejs(["text!"+u],function(n){n!=null?i.resolve(n):i.reject()},function(n){return i.reject(n)}),i}var t=n.Errors,i=window.crossroads,u=function(){function i(t,i,r){if(!t)throw n.Errors.argumentNull("controller");if(!i)throw n.Errors.argumentNull("name");if(!r)throw n.Errors.argumentNull("handle");if(!$.isFunction(r))throw n.Errors.paramTypeError("handle","Function");this._name=i;this._handle=r}return i.prototype.name=function(){return this._name},i.prototype.execute=function(i){if(!i)throw t.argumentNull("page");var r=this._handle.apply({},[i]);return n.Utility.isDeferred(r)?r:$.Deferred().resolve()},i}();n.Action=u;n.createActionDeferred=f;n.createViewDeferred=e}(chitu||(chitu={})),function(n){function e(t,i,r){return r===void 0&&(r={}),n.fireCallback(t,[i,r])}var i=n,g=n.Utility,f=n.Errors,l="page-node",a="page-header",v="page-body",y="page-footer",p="page-loading",w="page-content",b='<i class="icon-spinner icon-spin"><\/i><span style="padding-left:10px;">数据正在加载中...<\/span>',o,r,s,h,c,t;(function(n){n[n.open=0]="open";n[n.scroll=1]="scroll";n[n.pullDown=2]="pullDown";n[n.pullUp=3]="pullUp";n[n.custom=4]="custom"})(n.PageLoadType||(n.PageLoadType={}));o=n.PageLoadType;r=function(){function t(t,i,r){if(t==null)throw n.Errors.argumentNull("page");this._page=t;this.loadType=i;this.loading=r}return Object.defineProperty(t.prototype,"enableScrollLoad",{set:function(n){this._page.enableScrollLoad=n},enumerable:!0,configurable:!0}),t}();n.PageLoadArguments=r,function(n){n[n.swipeLeft=0]="swipeLeft";n[n.swipeRight=1]="swipeRight";n[n.none=2]="none"}(s||(s={})),function(n){n[n.header=1]="header";n[n.body=2]="body";n[n.loading=4]="loading";n[n.footer=8]="footer"}(h||(h={})),function(n){n[n.open=0]="open";n[n.closed=1]="closed"}(c||(c={})),function(n){n[n.None=0]="None";n[n.Left=1]="Left";n[n.Right=2]="Right";n[n.Up=3]="Up";n[n.Donw=4]="Donw"}(n.SwipeDirection||(n.SwipeDirection={}));t=n.SwipeDirection,function(n){n[n.IScroll=0]="IScroll";n[n.Div=1]="Div";n[n.Document=2]="Document"}(n.ScrollType||(n.ScrollType={}));var u=n.ScrollType,k=function(){function n(n){n.className=l;this.container=n;this.header=document.createElement("div");this.header.className=a;n.appendChild(this.header);this.body=document.createElement("div");this.body.className=v;n.appendChild(this.body);this.content=document.createElement("div");this.content.className=w;$(this.content).hide();this.body.appendChild(this.content);this.loading=document.createElement("div");this.loading.className=p;this.loading.innerHTML='<div class="spin"><i class="icon-spinner icon-spin"><\/i><div>';$(this.loading).hide();this.body.appendChild(this.loading);this.footer=document.createElement("div");this.footer.className=y;n.appendChild(this.footer)}return n}(),d=function(){function s(t,r,e){var o=this;if(this._loadViewModelResult=null,this._openResult=null,this._hideResult=null,this._showTime=s.animationTime,this._hideTime=s.animationTime,this._enableScrollLoad=!1,this.is_closed=!1,this.actionExecuted=$.Deferred(),this.isActionExecuted=!1,this.preLoad=i.Callbacks(),this.load=i.Callbacks(),this.loadCompleted=i.Callbacks(),this.closing=i.Callbacks(),this.closed=i.Callbacks(),this.scroll=i.Callbacks(),this.showing=i.Callbacks(),this.shown=i.Callbacks(),this.hiding=i.Callbacks(),this.hidden=i.Callbacks(),this.scrollEnd=i.Callbacks(),this.viewChanged=$.Callbacks(),!t)throw f.argumentNull("element");if(r==null)throw f.argumentNull("scrollType");this._prevous=e;this._pageNode=new k(t);this.disableHeaderFooterTouchMove();this._scrollType=r;r==u.IScroll?($(this.nodes().container).addClass("ios"),this.ios_scroller=new IOSScroll(this),n.gesture.enable_iscroll_gesture(this,null,null)):r==u.Div?($(this.nodes().container).addClass("div"),new DisScroll(this),n.gesture.enable_divfixed_gesture(this,null,null)):r==u.Document&&($(this.nodes().container).addClass("doc"),new DocumentScroll(this));this.scrollEnd.add(s.page_scrollEnd);e&&e.closed.add(function(){return o.close()});this.formLoading={show:function(){$(o.nodes().loading).is(":visible")||($(o.nodes().loading).show(),$(o.nodes().content).hide())},hide:function(){$(o.nodes().loading).hide();$(o.nodes().content).show()}};this.bottomLoading={show:function(){o.showScrollLoadingBar()},hide:function(){o.hideScrollLoadingBar()}}}return s.prototype.createPageLoadArguments=function(n,t,i){var u=new r(this,t,i);return $.extend(u,n||{})},Object.defineProperty(s.prototype,"view",{get:function(){return this._viewDeferred},set:function(n){this._viewDeferred=n},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"action",{get:function(){return this._actionDeferred},set:function(n){this._actionDeferred=n},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"enableScrollLoad",{get:function(){return this._enableScrollLoad},set:function(n){this._enableScrollLoad=n},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewHtml",{get:function(){return this.nodes().container.innerHTML},set:function(n){this.nodes().content.innerHTML=n;var t=this.nodes().content.querySelector('[ch-part="header"]');t&&this.nodes().header.appendChild(t);t=this.nodes().content.querySelector('[ch-part="footer"]');t&&this.nodes().footer.appendChild(t);this.viewChanged.fire()},enumerable:!0,configurable:!0}),s.getPageName=function(n){var t,i;return n.pageName()?(i=window.crossroads.addRoute(n.pageName()),t=i.interpolate(n.values())):t=n.values().controller+"."+n.values().action,t},Object.defineProperty(s.prototype,"routeData",{get:function(){return this._routeData},set:function(n){this._routeData=n},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"name",{get:function(){return this._name||(this._name=s.getPageName(this.routeData)),this._name},enumerable:!0,configurable:!0}),s.prototype.node=function(){return this._pageNode.container},s.prototype.nodes=function(){return this._pageNode},Object.defineProperty(s.prototype,"previous",{get:function(){return this._prevous},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"scrollType",{get:function(){return this._scrollType},enumerable:!0,configurable:!0}),s.prototype.hide=function(n){$(this.node()).is(":visible")&&(n=n||t.None,this.hidePageNode(n))},s.prototype.show=function(n){$(this.node()).is(":visible")||(n=n||t.None,this.showPageNode(n))},s.prototype.visible=function(){return $(this.node()).is(":visible")},s.prototype.hidePageNode=function(n){var u=this;this.on_hiding({});window.move||(n=t.None,console.warn("Move is not loaded and swipe is auto disabled."));var f=$.Deferred(),e=$(this.nodes().container).width(),r=$(this.nodes().container).height(),i=function(){$(u.node()).hide();f.resolve();u.on_hidden({})};switch(n){case t.None:default:i();break;case t.Up:move(this.nodes().container).y(r).end().y(0-r).duration(this._hideTime).end(i);break;case t.Donw:move(this.nodes().container).y(r).duration(this._hideTime).end(i);break;case t.Right:move(this.node()).x(e).duration(this._hideTime).end(i);break;case t.Left:move(this.node()).x(0-e).duration(this._hideTime).end(i)}return f},s.prototype.showPageNode=function(n){var e=this,r;window.move||(n=t.None,console.warn("Move is not loaded and swipe is auto disabled."));this.on_showing({});r=$.Deferred();this.node().style.display="block";var u=$(this.nodes().container).width(),f=$(this.nodes().container).height(),i=function(){r.resolve()};switch(n){case t.None:default:i();break;case t.Donw:move(this.node()).y(0-f).duration(0).end(i);move(this.node()).y(0).duration(0).end(i);break;case t.Up:move(this.node()).y(f).duration(0).end();move(this.node()).y(0).duration(this._showTime).end(i);break;case t.Right:move(this.node()).x(0-u).duration(0).end();move(this.node()).x(0).duration(this._showTime).end(i);break;case t.Left:move(this.node()).x(u).duration(0).end();move(this.node()).x(0).duration(this._showTime).end(i)}return r.done(function(){e.on_shown({})}),r},s.prototype.ensureScrollLoadingBar=function(){this.scrollLoad_loading_bar==null&&(this.scrollLoad_loading_bar=document.createElement("div"),this.scrollLoad_loading_bar.innerHTML='<div name="scrollLoad_loading" style="padding:10px 0px 10px 0px;"><h5 class="text-center"><\/h5><\/div>',this.scrollLoad_loading_bar.style.display="none",$(this.scrollLoad_loading_bar).find("h5").html(b),this.nodes().content.appendChild(this.scrollLoad_loading_bar))},s.prototype.showScrollLoadingBar=function(){this.ensureScrollLoadingBar();$(this.scrollLoad_loading_bar).is(":visible")==!1&&($(this.scrollLoad_loading_bar).show(),this.refreshUI())},s.prototype.hideScrollLoadingBar=function(){this.ensureScrollLoadingBar();$(this.scrollLoad_loading_bar).is(":visible")&&($(this.scrollLoad_loading_bar).hide(),this.refreshUI())},s.prototype.fireEvent=function(n,t){var i=this;return this.actionExecuted.state()=="resolved"?e(n,this,t):this.actionExecuted.pipe(function(){return e(n,i,t)})},s.prototype.disableHeaderFooterTouchMove=function(){$([this.nodes().footer,this.nodes().header]).on("touchmove",function(n){n.preventDefault()})},s.prototype.on_load=function(t){var f=this,u=t instanceof r?t:new r(this,t.loadType,t.loading),i;return u.loading==null&&(u.loading=t.loadType==n.PageLoadType.scroll?this.bottomLoading:this.formLoading),u.loading.show(),i=this.fireEvent(this.load,t),i.done(function(){return u.loading.hide()}),this.view==null?i.done(function(){return f.on_loadCompleted(t)}):this.view.state()=="resolved"?i.done(function(){return f.on_loadCompleted(t)}):$.when(this.view,i).done(function(){return f.on_loadCompleted(t)}),i},s.prototype.on_loadCompleted=function(n){var t=this;return this.fireEvent(this.loadCompleted,n).done(function(){window.setTimeout(function(){return t.refreshUI()},100)})},s.prototype.on_closing=function(n){return this.fireEvent(this.closing,n)},s.prototype.on_closed=function(n){return this.fireEvent(this.closed,n)},s.prototype.on_scroll=function(n){return this.fireEvent(this.scroll,n)},s.prototype.on_showing=function(n){return this.fireEvent(this.showing,n)},s.prototype.on_shown=function(n){return this.fireEvent(this.shown,n)},s.prototype.on_hiding=function(n){return this.fireEvent(this.hiding,n)},s.prototype.on_hidden=function(n){return this.fireEvent(this.hidden,n)},s.prototype.on_scrollEnd=function(n){return this.fireEvent(this.scrollEnd,n)},s.prototype.open=function(i,r){var u=this,e,f;if(this._openResult)return this._openResult;if(r=r||t.None,e=this.showPageNode(r),f=this.createPageLoadArguments(i,n.PageLoadType.open,this.formLoading),f.loading.show(),this.view==null&&this.viewHtml==null)throw n.Errors.viewCanntNull();return this.action&&this.action.done(function(n){n.execute(u);u.actionExecuted.resolve();u.view&&u.view.done(function(n){return u.viewHtml=n});u.on_load(f)}),e},s.prototype.close=function(n,t){var i=this;if(!this.is_closed){this.on_closing(n);this.visible()?this.hidePageNode(t).done(function(){$(i.node()).remove()}):$(this.node()).remove();n=n||{};this.on_closed(n);this.is_closed=!0}},s.page_scrollEnd=function(n,t){var u=t.scrollTop,f=t.scrollHeight,i=t.clientHeight,e=i/3,r,s;i+u<f-e||n.enableScrollLoad&&(r=$.extend(n.routeData.values(),{loadType:o.scroll,loading:n.bottomLoading}),s=n.on_load(r))},s.prototype.refreshUI=function(){this.ios_scroller&&this.ios_scroller.refresh()},s.animationTime=300,s}();n.Page=d}(chitu||(chitu={})),function(n){var t=function(){function n(n,t){this._view=n;this._routeData=t}return n.prototype.view=function(){return this._view},n.prototype.routeData=function(){return this._routeData},n}();n.PageContext=t}(chitu||(chitu={})),function(n){var t=function(){function n(n,t,i){this._name=n;this._pattern=t;this._defaults=i}return n.prototype.name=function(){return this._name},n.prototype.defaults=function(){return this._defaults},n.prototype.url=function(){return this._pattern},n}();n.Route=t}(chitu||(chitu={})),function(n){var r=n,t=n.Errors,i=function(){function i(){this._init()}return i.prototype._init=function(){var n=window.crossroads;this._source=n.create();this._source.ignoreCase=!0;this._source.normalizeFn=n.NORM_AS_OBJECT;this._priority=0},i.prototype.count=function(){return this._source.getNumRoutes()},i.prototype.mapRoute=function(i){var r,f;i=i||{};var e=i.name,u=i.url,o=i.defaults,s=i.rules||{};if(!e)throw t.argumentNull("name");if(!u)throw t.argumentNull("url");if(this._priority=this._priority+1,r=new n.Route(e,u,o),r.viewPath=i.viewPath,r.actionPath=i.actionPath,f=this._source.addRoute(u,function(){},this._priority),f.rules=s,f.newRoute=r,this._defaultRoute==null){if(this._defaultRoute=r,this._defaultRoute.viewPath==null)throw new Error("default route require view path.");if(this._defaultRoute.actionPath==null)throw new Error("default route require action path.");}return r.viewPath=r.viewPath||this._defaultRoute.viewPath,r.actionPath=r.actionPath||this._defaultRoute.actionPath,r},i.prototype.getRouteData=function(i){var r=this._source.getRouteData(i),e,o,f,s,u;if(r==null)throw t.canntParseUrl(i);for(e={},o=r.route._paramsIds||[],f=0;f<o.length;f++)s=o[f],e[s]=r.params[0][s];return u=new n.RouteData(i),u.values(e),u.actionPath(r.route.newRoute.actionPath),u.viewPath(r.route.newRoute.viewPath),u},i.defaultRouteName="default",i}();n.RouteCollection=i}(chitu||(chitu={})),function(n){var t=function(){function n(n){this._url=n}return n.prototype.values=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._values=n),this._values},n.prototype.viewPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._viewPath=n),this._viewPath},n.prototype.actionPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._actionPath=n),this._actionPath},n.prototype.pageName=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._pageName=n),this._pageName},n.prototype.url=function(){return this._url},n}();n.RouteData=t}(chitu||(chitu={})),function(n){var i=n,f=n.Utility,t=n.Errors,r=10,u=function(){function u(r){if(this.pageCreating=i.Callbacks(),this.pageCreated=i.Callbacks(),this.page_stack=[],this._routes=new n.RouteCollection,this._runned=!1,r==null)throw t.argumentNull("container");if(!r.container)throw new Error("The config has not a container property.");if(!$.isFunction(r.container)&&!r.container.tagName)throw new Error("Parameter container is not a function or html element.");r.openSwipe=r.openSwipe||function(){return n.SwipeDirection.None};r.closeSwipe=r.closeSwipe||function(){return n.SwipeDirection.None};r.scrollType=r.scrollType||function(){return n.ScrollType.Document};this.config=r}return u.prototype.on_pageCreating=function(t){return n.fireCallback(this.pageCreating,[this,t])},u.prototype.on_pageCreated=function(t){return n.fireCallback(this.pageCreated,[this,t])},u.prototype.routes=function(){return this._routes},u.prototype.currentPage=function(){return this.page_stack.length>0?this.page_stack[this.page_stack.length-1]:null},u.prototype.previousPage=function(){return this.page_stack.length>1?this.page_stack[this.page_stack.length-2]:null},u.prototype.hashchange=function(){var t,n,i,r;if(window.location.skip==!0){window.location.skip=!1;return}if(this.back_deferred&&this.back_deferred.processed==null&&(t=this.back_deferred,t.processed=!0),n=window.location.hash,!n||n==this.start_flag_hash){n||console.log("The url is not contains hash.url is "+window.location.href);n==this.start_flag_hash&&(window.history.pushState({},"",this.start_hash),console.log("The hash is start url, the hash is "+n));t&&t.reject();return}this.start_flag_hash||(this.start_flag_hash="#AABBCCDDEEFF",this.start_hash=n,window.history.replaceState({},"",this.start_flag_hash),window.history.pushState({},"",n));i="";this.previousPage()!=null&&(i=this.previousPage().routeData.url());i.toLowerCase()==n.substr(1).toLowerCase()?this.closeCurrentPage():(r=window.location.arguments||{},window.location.arguments=null,this.showPage(n.substr(1),r));t&&t.resolve()},u.prototype.run=function(){if(!this._runned){var n=this;$.proxy(this.hashchange,this)();$(window).bind("hashchange",$.proxy(this.hashchange,this));this._runned=!0}},u.prototype.getCachePage=function(n){for(var t=this.page_stack.length-1;t>=0;t--)if(this.page_stack[t].name==n)return this.page_stack[t];return null},u.prototype.showPage=function(n,i){var u,f,e,s,o,h,c;if(i=i||{},!n)throw t.argumentNull("url");if(u=this.routes().getRouteData(n),u==null)throw t.noneRouteMatched(n);if($.isFunction(this.config.container)){if(f=this.config.container(u.values()),f==null)throw new Error("The result of continer function cannt be null");}else f=this.config.container;return e=this.currentPage(),s=document.createElement("div"),f.appendChild(s),o=this.createPage(n,s,e),this.page_stack.push(o),console.log("page_stack lenght:"+this.page_stack.length),this.page_stack.length>r&&(h=this.page_stack.shift(),h.close({})),c=this.config.openSwipe(u),$.extend(i,u.values()),o.open(i,c).done(function(){e&&e.hide()}),o},u.prototype.createPageNode=function(){return document.createElement("div")},u.prototype.closeCurrentPage=function(){var n=this.currentPage(),t=this.previousPage(),i;n!=null&&(i=this.config.closeSwipe(n.routeData),n.close({},i),t!=null&&t.show(),this.page_stack.pop(),console.log("page_stack lenght:"+this.page_stack.length))},u.prototype.createPage=function(r,u,f){var e,c,o;if(!r)throw t.argumentNull("url");if(!u)throw t.argumentNull("element");if(e=this.routes().getRouteData(r),e==null)throw t.noneRouteMatched(r);var a=e.values().controller,v=e.values().action,s=n.createViewDeferred(e),l=n.createActionDeferred(e),h=new i.PageContext(s,e);this.on_pageCreating(h);c=this.config.scrollType(e);o=new i.Page(u,c,f);o.routeData=e;o.view=s;o.action=l;this.on_pageCreated(o,h);return o},u.prototype.redirect=function(n,t){return t===void 0&&(t={}),window.location.skip=!0,window.location.hash=n,this.showPage(n,t)},u.prototype.back=function(n){return(n===void 0&&(n=undefined),this.back_deferred=$.Deferred(),window.history.length==0)?(this.back_deferred.reject(),this.back_deferred):(window.history.back(),this.back_deferred)},u}();n.Application=u}(chitu||(chitu={}));var ScrollArguments=function(){function n(){}return n}(),DisScroll=function(){function n(n){var t=new ScrollArguments,u,i,f=300,e=function(n){i==null&&(i=0,i=window.setInterval(function(){if(u==t.scrollTop){window.clearInterval(i);i=null;u=null;n.on_scrollEnd(t);return}u=t.scrollTop},f))},r=n.nodes().body;r.onscroll=function(){var i={scrollTop:r.scrollTop,scrollHeight:r.scrollHeight,clientHeight:r.clientHeight};n.on_scroll(i);t.clientHeight=i.clientHeight;t.scrollHeight=i.scrollHeight;t.scrollTop=i.scrollTop;e(n)}}return n}(),cur_scroll_args=new ScrollArguments,pre_scroll_top,checking_num,CHECK_INTERVAL=300;DocumentScroll=function(){function n(n){$(document).scroll(function(){if(n.visible()){var t={scrollTop:$(document).scrollTop(),scrollHeight:document.body.scrollHeight,clientHeight:$(window).height()};cur_scroll_args.clientHeight=t.clientHeight;cur_scroll_args.scrollHeight=t.scrollHeight;cur_scroll_args.scrollTop=t.scrollTop;$(n.node()).data(n.name+"_scroll_top",t.scrollTop);scrollEndCheck(n)}});n.shown.add(function(){var t=$(n.node()).data(n.name+"_scroll_top");t!=null&&$(document).scrollTop(new Number(t).valueOf())})}return n}();IOSScroll=function(){function n(n){var t=this;requirejs(["iscroll"],function(){return t.init(n)})}return n.prototype.init=function(n){var t=this.iscroller=n.iscroller=new IScroll(n.nodes().body,{tap:!0,useTransition:!1,HWCompositing:!1,preventDefault:!0,probeType:1});t.on("scrollEnd",function(){var t=this,i={scrollTop:0-t.y,scrollHeight:t.scrollerHeight,clientHeight:t.wrapperHeight};console.log("directionY:"+t.directionY);console.log("startY:"+t.startY);console.log("scroller.y:"+t.y);n.on_scrollEnd(i)});t.on("scroll",function(){var t=this,i={scrollTop:0-t.y,scrollHeight:t.scrollerHeight,clientHeight:t.wrapperHeight};console.log("directionY:"+t.directionY);console.log("startY:"+t.startY);console.log("scroller.y:"+t.y);n.on_scroll(i)});(function(t,i){$(i).on("tap",function(t){if(n.iscroller.enabled!=!1)for(var r=1,i=t.target;i!=null;){if(i.tagName=="A")return window.open($(i).attr("href"),"_self");if(i=i.parentNode,r=r+1,r>4)return}})})(t,n.nodes().body);n.closing.add(function(){return t.destroy()});$(window).on("resize",function(){window.setTimeout(function(){return t.refresh()},500)})},n.prototype.refresh=function(){this.iscroller&&this.iscroller.refresh()},n}();chitu.scroll=function(n){$(n.nodes().body).addClass("wrapper");$(n.nodes().content).addClass("scroller");var t=n._wrapperNode=n.nodes().body;n._scrollerNode=n.nodes().content},function(n){var t;(function(n){function o(n,t){var f,e;return t=t||{},t=$.extend({text:function(n){this.element.innerHTML=r[n]}},t),f=t.element,f==null&&(f=document.createElement("div"),f.className="page-pulldown",f.innerHTML=i.init,e=n.nodes().content,e.childNodes.length==0?e.appendChild(f):e.insertBefore(f,e.childNodes[0]),t.element=f),new u(t)}var f,t,r,i,u,e;n.createPullDownBar=o;f=function(){function n(){}return n.PULLDOWN_EXECUTE_CRITICAL_HEIGHT=60,n.PULLUP_EXECUTE_CRITICAL_HEIGHT=60,n.PULL_DOWN_MAX_HEIGHT=150,n.PULL_UP_MAX_HEIGHT=150,n.MINI_MOVE_DISTANCE=3,n}();n.config=f;t=function(){function n(){}return n.init="init",n.ready="ready",n.doing="doing",n.done="done",n}();n.RefreshState=t;r=function(){function n(){}return n.init='<div style="padding-top:10px;">下拉可以刷新<\/div>',n.ready='<div style="padding-top:10px;">松开后刷新<\/div>',n.doing='<div style=""><i class="icon-spinner icon-spin"><\/i><span>&nbsp;正在更新中<\/span><\/div>',n.done='<div style="padding-top:10px;">更新完毕<\/div>',n}();n.PullDownStateText=r;i=function(){function n(){}return n.init="上拉可以刷新",n.ready="松开后刷新",n.doing='<div><i class="icon-spinner icon-spin"><\/i><span>&nbsp;正在更新中<\/span><\/div>',n.done="更新完毕",n}();n.PullUpStateText=i;u=function(){function n(n){this._config=n;this.status(t.init)}return n.prototype.status=function(n){if(n===void 0&&(n=undefined),n===undefined)return this._status;this._status=n;this._config.text(n)},n.prototype.execute=function(){var i=this,n=$.Deferred();return window.setTimeout(function(){return n.resolve()},2e3),n.done(function(){return i.status(t.init)}),n},n.createPullDownBar=function(t,u){var f,e;return u=u||{},u=$.extend({text:function(n){this.element.innerHTML=r[n]}},u),f=u.element,f==null&&(f=document.createElement("div"),f.className="page-pulldown",f.innerHTML=i.init,e=t.nodes().content,e.childNodes.length==0?e.appendChild(f):e.insertBefore(f,e.childNodes[0]),u.element=f),new n(u)},n}();n.PullDownBar=u;e=function(){function n(n){this._config=n;this.status(t.init)}return n.prototype.status=function(n){if(n===void 0&&(n=undefined),n===undefined)return this._status;this._status=n;this._config.text(n)},n.prototype.execute=function(){var i=this,n=this._config.execute();return n!=null&&$.isFunction(n.done)&&n.done(function(){return i.status(t.init)}),n},n.createPullUpBar=function(t,r){var u,f;return r=r||{},r=$.extend({execute:function(){},text:function(n){this.element.innerHTML=i[n]}},r),u=t.nodes().pullup,u==null&&(u=document.createElement("div"),u.className="page-pullup",u.style.textAlign="center",f=t.nodes().content,f.appendChild(u)),r.element=u,new n(r)},n}();n.PullUpBar=e})(t=n.gesture||(n.gesture={}))}(chitu||(chitu={})),function(n){var t;(function(n){function t(t,i,r,u){var h=0,v=i.cur_scroll_args,e=t(i.nodes().content),l,o=!1,c,a,s=!1,f=new Hammer(i.nodes().content);f.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN});f.on("panstart",function(n){var e=i.nodes().content.getBoundingClientRect(),v=i.nodes().body.getBoundingClientRect();c==null&&(c=e.top);a==null&&(a=e.height-$(i.nodes().body).height());h=n.deltaY;o=u!=null&&Math.abs(v.bottom-e.bottom)<=20&&n.direction==Hammer.DIRECTION_UP;o&&(l=t(i.nodes().body));s=r!=null&&Math.abs(e.top-c)<=20&&n.direction==Hammer.DIRECTION_DOWN;s===!0&&f.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN,domEvents:!1})});f.on("pan",function(t){var i=t;i.distance>n.config.PULL_DOWN_MAX_HEIGHT||(s===!0?(e.set("top",i.deltaY+"px").duration(0).end(),Math.abs(i.deltaY)>n.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT?r.status(n.RefreshState.ready):r.status(n.RefreshState.init),i.preventDefault()):o&&(l.y(i.deltaY-h).duration(0).end(),Math.abs(i.deltaY)>n.config.PULLUP_EXECUTE_CRITICAL_HEIGHT?u.status(n.RefreshState.ready):u.status(n.RefreshState.init)),h=t.deltaY)});f.on("panend",function(){var f=$.Deferred(),h;s===!0?r.status()==n.RefreshState.ready?(e.set("top",n.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT+"px").duration(200).end(),r.status(n.RefreshState.doing),r.execute().done(function(){r.status(n.RefreshState.done);e.set("top","0px").duration(500).end(function(){console.log("scrollTop");f.resolve()})})):e.set("top","0px").duration(200).end(function(){return f.resolve()}):o&&(u.status()==n.RefreshState.ready&&u.execute(),h=t(i.nodes().body),h.y(0).duration(200).end())})}function i(n,i,r){requirejs(["move","hammer"],function(u,f){window.Hammer=f;t(u,n,i,r)})}n.enable_divfixed_gesture=i})(t=n.gesture||(n.gesture={}))}(chitu||(chitu={})),function(n){var t;(function(n){function t(t,i,r,u){console.log("enable_ios_gesture");var h=0,a=i.cur_scroll_args,s=t(i.nodes().content),c,l,f=!1,e=!1,o=new Hammer(i.nodes().content);o.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN});o.on("panstart",function(n){h=n.deltaY;f=u!=null&&Math.abs(i.iscroller.startY-i.iscroller.maxScrollY)<=20&&n.direction==Hammer.DIRECTION_UP;f&&(c=t(i.nodes().body));e=r!=null&&Math.abs(i.iscroller.startY)<=20&&n.direction==Hammer.DIRECTION_DOWN;(e===!0||f===!0)&&(i.iscroller.enabled&&(i.iscroller.disable(),console.log("iscrol disable"),l=!0),o.get("pan").set({direction:Hammer.DIRECTION_UP|Hammer.DIRECTION_DOWN,domEvents:!1}))});o.on("pan",function(t){var i=t;i.distance>n.config.PULL_DOWN_MAX_HEIGHT||(e===!0?(s.set("top",i.deltaY+"px").duration(0).end(),i.deltaY>n.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT?r.status(n.RefreshState.ready):r.status(n.RefreshState.init)):f&&(c.y(i.deltaY-h).duration(0).end(),Math.abs(i.deltaY)>n.config.PULLUP_EXECUTE_CRITICAL_HEIGHT?u.status(n.RefreshState.ready):u.status(n.RefreshState.init)),i.preventDefault(),h=t.deltaY)});o.on("panend",function(o){var h=$.Deferred(),c,a;e===!0?r.status()==n.RefreshState.ready?(s.set("top",n.config.PULLDOWN_EXECUTE_CRITICAL_HEIGHT+"px").duration(200).end(),r.status(n.RefreshState.doing),r.execute().done(function(){r.status(n.RefreshState.done);s.set("top","0px").duration(500).end(function(){console.log("scrollTop");h.resolve()})})):s.set("top","0px").duration(200).end(function(){return h.resolve()}):f&&(u.status()==n.RefreshState.ready&&u.execute(),c=t(i.nodes().body),c.y(0).duration(200).end());a=i.nodes().content.getBoundingClientRect();f=u!=null&&Math.abs(i.iscroller.startY-i.iscroller.maxScrollY)<=20&&o.direction==Hammer.DIRECTION_UP;console.log(u);console.log(i.iscroller);console.log("enablePullUp:"+f);e=r!=null&&a.top<=0&&o.direction==Hammer.DIRECTION_DOWN;window.setTimeout(function(){l&&i.iscroller.enable()},100)})}function i(n,i,r){requirejs(["move","hammer"],function(u,f){window.Hammer=f;t(u,n,i,r)})}n.enable_iscroll_gesture=i})(t=n.gesture||(n.gesture={}))}(chitu||(chitu={}));
//# sourceMappingURL=chitu.min.js.map
